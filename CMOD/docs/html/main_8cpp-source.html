<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>CMOD: main.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>main.cpp</h1><a href="main_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment">CMOD (composition module)</span>
00003 <span class="comment">Copyright (C) 2005  Sever Tipei (s-tipei@uiuc.edu)</span>
00004 <span class="comment">                                                                                </span>
00005 <span class="comment">This program is free software; you can redistribute it and/or</span>
00006 <span class="comment">modify it under the terms of the GNU General Public License</span>
00007 <span class="comment">as published by the Free Software Foundation; either version 2</span>
00008 <span class="comment">of the License, or (at your option) any later version.</span>
00009 <span class="comment">                                                                                </span>
00010 <span class="comment">This program is distributed in the hope that it will be useful,</span>
00011 <span class="comment">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00012 <span class="comment">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00013 <span class="comment">GNU General Public License for more details.</span>
00014 <span class="comment">                                                                                </span>
00015 <span class="comment">You should have received a copy of the GNU General Public License</span>
00016 <span class="comment">along with this program; if not, write to the Free Software</span>
00017 <span class="comment">Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.</span>
00018 <span class="comment">*/</span>
00019 
00020 <span class="comment">//-----------------------------------------------------------------------//</span>
00021 <span class="comment">// </span>
00022 <span class="comment">//  main.ccp</span>
00023 <span class="comment">// </span>
00024 <span class="comment">//  This is the main program for CMOD, the computer-assisted</span>
00025 <span class="comment">//  composition software part of the EMCS.</span>
00026 <span class="comment">//  It seeds the random number generator, loads the envelope</span>
00027 <span class="comment">//  library and calls first the constructor, then the "build"</span>
00028 <span class="comment">//  function for the class Top.</span>
00029 <span class="comment">//----------------------------------------------------------------------//</span>
00030 
00031 
00041 <span class="preprocessor">#include "../../LASS/src/lib.h"</span>
00042 
00043 
00044 <span class="preprocessor">#include &lt;cstdlib&gt;</span>
00045 <span class="preprocessor">#include &lt;cmath&gt;</span>
00046 <span class="preprocessor">#include &lt;ctime&gt;</span>
00047 <span class="preprocessor">#include &lt;string&gt;</span>
00048 <span class="preprocessor">#include &lt;iostream&gt;</span>
00049 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00050 
00051 <span class="preprocessor">#include "<a class="code" href="dataIn_8h.html">dataIn.h</a>"</span>
00052 <span class="preprocessor">#include "<a class="code" href="top_8h.html">top.h</a>"</span>
00053 <span class="preprocessor">#include "<a class="code" href="utility_8h.html">utility.h</a>"</span>
00054 <span class="preprocessor">#include "<a class="code" href="random_8h.html">random.h</a>"</span>
00055 <span class="preprocessor">#include "<a class="code" href="piece_8h.html">piece.h</a>"</span>
00056 <span class="preprocessor">#include "lexyacc/eventparser.h"</span>
00057 
00058 
<a name="l00059"></a><a class="code" href="main_8cpp.html#a0">00059</a> ofstream * <a class="code" href="bottom_8cpp.html#a0">outputFile</a>;
00060 
<a name="l00061"></a><a class="code" href="main_8cpp.html#a1">00061</a> EnvelopeLibrary <a class="code" href="main_8cpp.html#a1">envlib_cmod</a>;
<a name="l00062"></a><a class="code" href="main_8cpp.html#a2">00062</a> Score <a class="code" href="bottom_8cpp.html#a4">score</a>;
00063 
<a name="l00064"></a><a class="code" href="main_8cpp.html#a3">00064</a> vector&lt;Reverb *&gt; <a class="code" href="main_8cpp.html#a3">reverbObjList</a>;
<a name="l00065"></a><a class="code" href="main_8cpp.html#a4">00065</a> <span class="keywordtype">int</span> <a class="code" href="main_8cpp.html#a4">numChan</a>;
<a name="l00066"></a><a class="code" href="main_8cpp.html#a5">00066</a> <span class="keywordtype">char</span> * <a class="code" href="event_8cpp.html#a0">nameFlag</a>, * <a class="code" href="main_8cpp.html#a6">fileName</a>;
00067   
<a name="l00068"></a><a class="code" href="main_8cpp.html#a7">00068</a> <span class="keywordtype">int</span> <a class="code" href="main_8cpp.html#a7">sever</a>;
00069 
<a name="l00070"></a><a class="code" href="main_8cpp.html#a8">00070</a> <a class="code" href="classCMODPiece.html">CMODPiece</a> <a class="code" href="main_8cpp.html#a8">Piece</a>;
00071 
00072 
<a name="l00079"></a><a class="code" href="main_8cpp.html#a9">00079</a> <span class="keywordtype">int</span> <a class="code" href="main_8cpp.html#a9">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
00080 {
00081     
00082 string pieceName;
00083     string mainFile;
00084     <a class="code" href="classEventFactory.html">EventFactory</a> *mainFactory;
00085     <a class="code" href="classEvent.html">Event</a> *mainEvent;
00086 
00087     <span class="comment">// get mainfile from args or stdin  </span>
00088     <span class="keywordflow">if</span> (argc &gt;= 2)
00089     {
00090         pieceName = argv[1];
00091     }
00092     <span class="keywordflow">else</span>
00093     {
00094         cout &lt;&lt; <span class="stringliteral">"enter the name of the top level: "</span>;
00095         cin &gt;&gt; pieceName;
00096         cout &lt;&lt; endl;
00097     }
00098     mainFile = pieceName + <span class="stringliteral">".dat"</span>;
00099     string libraryFile = pieceName + <span class="stringliteral">".lib"</span>;
00100     <span class="keywordtype">char</span> *temp_str = strdup(libraryFile.c_str());
00101     <a class="code" href="main_8cpp.html#a1">envlib_cmod</a>.loadLibrary(temp_str);
00102     free(temp_str);
00103 
00104         string out = <a class="code" href="main_8cpp.html#a8">Piece</a>.<a class="code" href="classCMODPiece.html#o0">title</a> + <span class="stringliteral">".particel"</span>;
00105         <a class="code" href="bottom_8cpp.html#a0">outputFile</a> = <span class="keyword">new</span> ofstream();
00106         <a class="code" href="bottom_8cpp.html#a0">outputFile</a>-&gt;open(out.c_str(), ios::out);
00107         
00108     time_t startJob = time(NULL);
00109 
00110     cout &lt;&lt; <span class="stringliteral">"Parsing "</span> &lt;&lt; mainFile &lt;&lt; endl;
00111 
00112     <span class="comment">//srand((unsigned int)time(NULL));</span>
00113     <span class="comment">// Parse main file</span>
00114     parseFile(mainFile, NULL, &amp;<a class="code" href="main_8cpp.html#a8">Piece</a>);
00115 
00116     cout &lt;&lt; <span class="stringliteral">"Parsing complete."</span> &lt;&lt; endl;
00117 
00118     <a class="code" href="main_8cpp.html#a8">Piece</a>.<a class="code" href="classCMODPiece.html#a30">Print</a>();
00119 
00120     <span class="comment">// create mainFactory</span>
00121     map &lt;string, EventFactory*&gt; FactoryLibrary;
00122 
00123     cout &lt;&lt; <span class="stringliteral">"Creating main event from "</span> &lt;&lt; <a class="code" href="main_8cpp.html#a8">Piece</a>.<a class="code" href="classCMODPiece.html#o2">topFile</a> &lt;&lt; endl;
00124     mainFactory = <span class="keyword">new</span> <a class="code" href="classEventFactory.html">EventFactory</a>(<a class="code" href="main_8cpp.html#a8">Piece</a>.<a class="code" href="classCMODPiece.html#o2">topFile</a>, FactoryLibrary);
00125 
00126     <span class="comment">// create mainEvent</span>
00127     mainEvent = mainFactory-&gt;<a class="code" href="classEventFactory.html#a63">Build</a>(0.0, <a class="code" href="main_8cpp.html#a8">Piece</a>.<a class="code" href="classCMODPiece.html#o9">length</a>, 0, FactoryLibrary);
00128 
00129     <span class="comment">// render mainEvent</span>
00130     <span class="keywordflow">if</span> (<a class="code" href="main_8cpp.html#a8">Piece</a>.<a class="code" href="classCMODPiece.html#o3">scoreFlag</a>)
00131     {
00132         <span class="comment">// Score score;</span>
00133         <span class="comment">// mainEvent-&gt;buildScore(&amp;s); - We just need an empty score.  Don't know what buildScore is for.</span>
00134         <a class="code" href="bottom_8cpp.html#a4">score</a>.setClippingManagementMode(Score::CHANNEL_ANTICLIP);
00135 
00136         <span class="comment">// render in numChans channels, rate</span>
00137         <span class="keywordtype">int</span> sizeFlag;
00138         <span class="keywordflow">switch</span>(<a class="code" href="main_8cpp.html#a8">Piece</a>.<a class="code" href="classCMODPiece.html#o7">sampleSize</a>)
00139         {
00140         <span class="keywordflow">default</span>:
00141         <span class="keywordflow">case</span> 16:
00142             sizeFlag = _16_BIT_LINEAR;
00143             <span class="keywordflow">break</span>;
00144         <span class="keywordflow">case</span> 24:
00145             sizeFlag = _24_BIT_LINEAR;
00146             <span class="keywordflow">break</span>;
00147         <span class="keywordflow">case</span> 32:
00148             sizeFlag = _32_BIT_LINEAR;
00149             <span class="keywordflow">break</span>;
00150         }
00151         MultiTrack* renderedScore = <a class="code" href="bottom_8cpp.html#a4">score</a>.render(<a class="code" href="main_8cpp.html#a8">Piece</a>.<a class="code" href="classCMODPiece.html#o5">numChannels</a>, 
00152                                                  <a class="code" href="main_8cpp.html#a8">Piece</a>.<a class="code" href="classCMODPiece.html#o6">sampleRate</a>, 
00153                                                  sizeFlag);
00154 
00155         <span class="comment">// write to file</span>
00156         string outputFile1;
00157         cout &lt;&lt; <span class="stringliteral">"how do you want to name this sound file ?"</span> &lt;&lt; endl;
00158         cin &gt;&gt; outputFile1;
00159         outputFile1 = <span class="stringliteral">"SoundFiles/"</span> + outputFile1;
00160         AuWriter::write(*renderedScore, outputFile1);
00161 
00162         <span class="comment">// output the xml!</span>
00163         <span class="comment">// score.xml_print();</span>
00164 
00165         <span class="keyword">delete</span> renderedScore;
00166     }
00167 
00168     time_t endJob = time(NULL);
00169     cout &lt;&lt; <span class="stringliteral">"This job took "</span> &lt;&lt; endJob - startJob &lt;&lt; <span class="stringliteral">"seconds.\n"</span>;
00170 
00171 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Mon Feb 12 14:24:38 2007 for CMOD by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
