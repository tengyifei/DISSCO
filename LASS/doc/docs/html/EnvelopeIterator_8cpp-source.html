<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>LASS: EnvelopeIterator.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>EnvelopeIterator.cpp</h1><a href="EnvelopeIterator_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment">LASS (additive sound synthesis library)</span>
00003 <span class="comment">Copyright (C) 2005  Sever Tipei (s-tipei@uiuc.edu)</span>
00004 <span class="comment"></span>
00005 <span class="comment">This program is free software; you can redistribute it and/or</span>
00006 <span class="comment">modify it under the terms of the GNU General Public License</span>
00007 <span class="comment">as published by the Free Software Foundation; either version 2</span>
00008 <span class="comment">of the License, or (at your option) any later version.</span>
00009 <span class="comment"></span>
00010 <span class="comment">This program is distributed in the hope that it will be useful,</span>
00011 <span class="comment">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00012 <span class="comment">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00013 <span class="comment">GNU General Public License for more details.</span>
00014 <span class="comment"></span>
00015 <span class="comment">You should have received a copy of the GNU General Public License</span>
00016 <span class="comment">along with this program; if not, write to the Free Software</span>
00017 <span class="comment">Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.</span>
00018 <span class="comment">*/</span>
00019 
00020 <span class="comment">//----------------------------------------------------------------------------//</span>
00021 <span class="comment">//</span>
00022 <span class="comment">// EnvelopeIterator.cpp</span>
00023 <span class="comment">//</span>
00024 <span class="comment">//----------------------------------------------------------------------------//</span>
00025 
00026 <span class="preprocessor">#ifndef __ENVELOPE_ITERATOR_CPP</span>
00027 <span class="preprocessor"></span><span class="preprocessor">#define __ENVELOPE_ITERATOR_CPP</span>
00028 <span class="preprocessor"></span>
00029 <span class="comment">//----------------------------------------------------------------------------//</span>
00030 
00031 <span class="preprocessor">#include "<a class="code" href="EnvelopeIterator_8h.html">EnvelopeIterator.h</a>"</span>
00032 <span class="preprocessor">#include "<a class="code" href="Envelope_8h.html">Envelope.h</a>"</span>
00033 
00034 <span class="comment">// #define DEBUG_MODE</span>
00035 
00036 <span class="comment">//----------------------------------------------------------------------------//</span>
<a name="l00037"></a><a class="code" href="classEnvelopeIterator.html#a0">00037</a> <a class="code" href="classEnvelopeIterator.html#a0">EnvelopeIterator::EnvelopeIterator</a>(
00038                                  <a class="code" href="classCollection.html">Collection&lt;Interpolator*&gt;</a> interpolators)
00039 {
00040 <span class="preprocessor">#ifdef DEBUG_MODE</span>
00041 <span class="preprocessor"></span>    cout &lt;&lt; <span class="stringliteral">"ENVI::Constructor"</span> &lt;&lt; endl;
00042     cout &lt;&lt; <span class="stringliteral">"size of interpolators: "</span> &lt;&lt; interpolators.<a class="code" href="classCollection.html#a10">size</a>() &lt;&lt; endl;
00043 <span class="preprocessor">#endif</span>
00044 <span class="preprocessor"></span>
00045     <span class="comment">// make a new collection</span>
00046     <a class="code" href="classEnvelopeIterator.html#r0">interpolators_</a> = <span class="keyword">new</span> <a class="code" href="classCollection.html">Collection&lt;Interpolator*&gt;</a> (interpolators);
00047 
00048     <span class="comment">// initialize Entry index (to the first valid Entry index value)</span>
00049     <a class="code" href="classEnvelopeIterator.html#r1">iSegmentIndex_</a> = 0;
00050 
00051     <span class="comment">// set our current Iterator to NULL</span>
00052     <span class="comment">// (once we need an iterator, we'll initialize it)</span>
00053     <a class="code" href="classEnvelopeIterator.html#r2">currentIterator_</a> = NULL;
00054 
00055     <span class="comment">// set a default initial value</span>
00056     <a class="code" href="classEnvelopeIterator.html#r3">currentValue_</a> = 0.0;
00057 
00058     <span class="comment">// initially assume we have at least 1 value to return</span>
00059     <a class="code" href="classEnvelopeIterator.html#r4">moreValues_</a> = <span class="keyword">true</span>;
00060 
00061 <span class="preprocessor">#ifdef DEBUG_MODE</span>
00062 <span class="preprocessor"></span>    cout &lt;&lt; <span class="stringliteral">"ENVI::Constructor"</span> &lt;&lt; endl;
00063 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iLoop = 0; iLoop &lt; <a class="code" href="classEnvelopeIterator.html#r0">interpolators_</a>-&gt;<a class="code" href="classCollection.html#a10">size</a>(); iLoop++)
00064 {
00065     cout &lt;&lt; <span class="stringliteral">"  Interpolator #"</span> &lt;&lt; iLoop &lt;&lt; <span class="stringliteral">" - has points: "</span> &lt;&lt; endl;
00066     <span class="keywordflow">if</span> (<a class="code" href="classEnvelopeIterator.html#r0">interpolators_</a>-&gt;<a class="code" href="classCollection.html#a7">get</a>(iLoop)-&gt;<a class="code" href="classCollection.html#a10">size</a>() != 2)
00067     {
00068         cout &lt;&lt; <span class="stringliteral">"     ERROR IN SIZE (size = "</span>;
00069         cout &lt;&lt; <a class="code" href="classEnvelopeIterator.html#r0">interpolators_</a>-&gt;<a class="code" href="classCollection.html#a7">get</a>(iLoop)-&gt;<a class="code" href="classCollection.html#a10">size</a>() &lt;&lt; endl;
00070     }
00071     cout &lt;&lt; <span class="stringliteral">"    ("</span> &lt;&lt; <a class="code" href="classEnvelopeIterator.html#r0">interpolators_</a>-&gt;<a class="code" href="classCollection.html#a7">get</a>(iLoop)-&gt;<a class="code" href="classCollection.html#a7">get</a>(0).<a class="code" href="classInterpolatorEntry.html#o0">time_</a> &lt;&lt; <span class="stringliteral">", "</span>;
00072     cout &lt;&lt; <a class="code" href="classEnvelopeIterator.html#r0">interpolators_</a>-&gt;<a class="code" href="classCollection.html#a7">get</a>(iLoop)-&gt;<a class="code" href="classCollection.html#a7">get</a>(0).<a class="code" href="classInterpolatorEntry.html#o1">value_</a> &lt;&lt; <span class="stringliteral">")"</span> &lt;&lt; endl;
00073     cout &lt;&lt; <span class="stringliteral">"    ("</span> &lt;&lt; <a class="code" href="classEnvelopeIterator.html#r0">interpolators_</a>-&gt;<a class="code" href="classCollection.html#a7">get</a>(iLoop)-&gt;<a class="code" href="classCollection.html#a7">get</a>(1).<a class="code" href="classInterpolatorEntry.html#o0">time_</a> &lt;&lt; <span class="stringliteral">", "</span>;
00074     cout &lt;&lt; <a class="code" href="classEnvelopeIterator.html#r0">interpolators_</a>-&gt;<a class="code" href="classCollection.html#a7">get</a>(iLoop)-&gt;<a class="code" href="classCollection.html#a7">get</a>(1).<a class="code" href="classInterpolatorEntry.html#o1">value_</a> &lt;&lt; <span class="stringliteral">")"</span> &lt;&lt; endl;
00075 }
00076 <span class="preprocessor">#endif</span>
00077 <span class="preprocessor"></span>}
00078 
00079 
00080 <span class="comment">//----------------------------------------------------------------------------//</span>
<a name="l00081"></a><a class="code" href="classEnvelopeIterator.html#a1">00081</a> <a class="code" href="classEnvelopeIterator.html#a1">EnvelopeIterator::~EnvelopeIterator</a>()
00082 {
00083     <span class="keywordflow">if</span> (<a class="code" href="classEnvelopeIterator.html#r0">interpolators_</a> != NULL)
00084     {
00085         <span class="keyword">delete</span> (<a class="code" href="classEnvelopeIterator.html#r0">interpolators_</a>);
00086     }
00087     <span class="keywordflow">if</span> (<a class="code" href="classEnvelopeIterator.html#r2">currentIterator_</a> != NULL)
00088     {
00089         <span class="keyword">delete</span> (<a class="code" href="classEnvelopeIterator.html#r2">currentIterator_</a>);
00090     }
00091 }
00092 
00093 
00094 <span class="comment">//----------------------------------------------------------------------------//</span>
00095 <span class="comment">// A B S T R A C T   I T E R A T O R   F U N C T I O N S</span>
00096 <span class="comment">//----------------------------------------------------------------------------//</span>
00097 
00098 
00099 <span class="comment">//----------------------------------------------------------------------------//</span>
<a name="l00100"></a><a class="code" href="classEnvelopeIterator.html#a2">00100</a> <a class="code" href="classEnvelopeIterator.html">EnvelopeIterator</a>* <a class="code" href="classEnvelopeIterator.html#a2">EnvelopeIterator::clone</a>()
00101 {
00102     <span class="keywordflow">return</span> (<span class="keyword">new</span> <a class="code" href="classEnvelopeIterator.html#a0">EnvelopeIterator</a>(*<span class="keyword">this</span>));
00103 }
00104 
00105 
00106 <span class="comment">//----------------------------------------------------------------------------//</span>
<a name="l00107"></a><a class="code" href="classEnvelopeIterator.html#a3">00107</a> <span class="keywordtype">bool</span> <a class="code" href="classEnvelopeIterator.html#a3">EnvelopeIterator::hasNext</a>()
00108 {
00109     <span class="comment">// let them know if we think we have more values</span>
00110     <span class="keywordflow">return</span> (<a class="code" href="classEnvelopeIterator.html#r4">moreValues_</a>);
00111 }
00112 
00113 
00114 <span class="comment">//----------------------------------------------------------------------------//</span>
<a name="l00115"></a><a class="code" href="classEnvelopeIterator.html#a4">00115</a> <a class="code" href="Types_8h.html#a3">m_value_type</a>&amp; <a class="code" href="classEnvelopeIterator.html#a4">EnvelopeIterator::next</a>()
00116 {
00117     <span class="keywordtype">bool</span> gotNewValue = <span class="keyword">false</span>;
00118     <span class="keywordtype">int</span> iNumInterpolators = <a class="code" href="classEnvelopeIterator.html#r0">interpolators_</a>-&gt;<a class="code" href="classCollection.html#a10">size</a>();
00119     
00120     <span class="comment">// if we haven't started iterating yet, start with the first iterator</span>
00121     <span class="keywordflow">if</span> ((<a class="code" href="classEnvelopeIterator.html#r2">currentIterator_</a> == NULL) &amp;&amp; (iNumInterpolators &gt; 0))
00122     {
00123         <a class="code" href="classEnvelopeIterator.html#r2">currentIterator_</a> = <span class="keyword">new</span> <a class="code" href="classIterator.html">Iterator&lt;m_value_type&gt;</a> 
00124             (<a class="code" href="classEnvelopeIterator.html#r0">interpolators_</a>-&gt;<a class="code" href="classCollection.html#a7">get</a>(0)-&gt;<a class="code" href="classInterpolator.html#a3">valueIterator</a>());
00125         
00126         <a class="code" href="classEnvelopeIterator.html#r1">iSegmentIndex_</a> = 0;
00127     }
00128 
00129     <span class="comment">// if we have an iterator to work with and it can give us a value</span>
00130     <span class="keywordflow">if</span> ((<a class="code" href="classEnvelopeIterator.html#r2">currentIterator_</a> != NULL) &amp;&amp; (<a class="code" href="classEnvelopeIterator.html#r2">currentIterator_</a>-&gt;<a class="code" href="classIterator.html#a4">hasNext</a>()))
00131     {
00132         <span class="comment">// get a value from the current Iterator</span>
00133         <a class="code" href="classEnvelopeIterator.html#r3">currentValue_</a> = <a class="code" href="classEnvelopeIterator.html#r2">currentIterator_</a>-&gt;<a class="code" href="classIterator.html#a5">next</a>();
00134         gotNewValue = <span class="keyword">true</span>;
00135 
00136 <span class="preprocessor">#ifdef DEBUG_MODE</span>
00137 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="classEnvelopeIterator.html#r5">tempCounter_</a> % 1000 == 0)
00138     {
00139         cout &lt;&lt; <span class="stringliteral">"got a value from the current iterator: "</span> &lt;&lt; <a class="code" href="classEnvelopeIterator.html#r3">currentValue_</a> &lt;&lt; endl;
00140     }
00141     <a class="code" href="classEnvelopeIterator.html#r5">tempCounter_</a>++;
00142 <span class="preprocessor">#endif</span>
00143 <span class="preprocessor"></span>    }
00144     <span class="keywordflow">else</span>
00145     {
00146         <span class="comment">// update our index to look at the next Iterator</span>
00147         <a class="code" href="classEnvelopeIterator.html#r1">iSegmentIndex_</a>++;
00148 
00149         <span class="comment">// find another Iterator to grab values from</span>
00150         <span class="keywordflow">while</span> (<a class="code" href="classEnvelopeIterator.html#r1">iSegmentIndex_</a> &lt; iNumInterpolators &amp;&amp; (!gotNewValue))
00151         {
00152             <span class="comment">// clear out the currently-stored Iterator</span>
00153             <span class="keywordflow">if</span> (<a class="code" href="classEnvelopeIterator.html#r2">currentIterator_</a> != NULL)
00154             {
00155                 <span class="keyword">delete</span> (<a class="code" href="classEnvelopeIterator.html#r2">currentIterator_</a>);
00156             }
00157 
00158             <span class="comment">// set current Iterator to the next Iterator</span>
00159             <a class="code" href="classEnvelopeIterator.html#r2">currentIterator_</a> = <span class="keyword">new</span> <a class="code" href="classIterator.html">Iterator&lt;m_value_type&gt;</a> 
00160                 (<a class="code" href="classEnvelopeIterator.html#r0">interpolators_</a>-&gt;<a class="code" href="classCollection.html#a7">get</a>(<a class="code" href="classEnvelopeIterator.html#r1">iSegmentIndex_</a>)-&gt;<a class="code" href="classInterpolator.html#a3">valueIterator</a>());
00161 
00162             <span class="comment">// see if we can grab values from this Iterator</span>
00163             <span class="keywordflow">if</span> ((*currentIterator_).hasNext())
00164             {
00165                 <span class="comment">// we've got a new value</span>
00166                 <a class="code" href="classEnvelopeIterator.html#r3">currentValue_</a> = <a class="code" href="classEnvelopeIterator.html#r2">currentIterator_</a>-&gt;<a class="code" href="classIterator.html#a5">next</a>();
00167                 gotNewValue = <span class="keyword">true</span>;
00168             }
00169 
00170             <span class="comment">// if we're here, then this Iterator is empty (which is dumb, but,</span>
00171             <span class="comment">// I'll allow for it), so update our index and keep looking</span>
00172             <a class="code" href="classEnvelopeIterator.html#r1">iSegmentIndex_</a>++;
00173         }
00174         
00175         <span class="comment">// we advanced one past the index that we want, so go back to it</span>
00176         <a class="code" href="classEnvelopeIterator.html#r1">iSegmentIndex_</a>--;
00177     }
00178 
00179     <span class="comment">// if we couldn't find another value to return, set flag to say that we have</span>
00180     <span class="comment">// no more values, and return the current value (this gives one extra value</span>
00181     <span class="comment">// at the end, which should be fixed)</span>
00182     <span class="keywordflow">if</span> (gotNewValue == <span class="keyword">false</span>)
00183     {
00184         <a class="code" href="classEnvelopeIterator.html#r4">moreValues_</a> = <span class="keyword">false</span>;
00185     }
00186 
00187     <span class="keywordflow">return</span> (<a class="code" href="classEnvelopeIterator.html#r3">currentValue_</a>);
00188 }
00189 
00190 
00191 <span class="comment">//----------------------------------------------------------------------------//</span>
00192 <span class="preprocessor">#endif //__ENVELOPE_ITERATOR_CPP</span>
00193 <span class="preprocessor"></span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Mon Apr 25 13:18:11 2005 for LASS by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
