<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>LASS: XmlReader.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>XmlReader.cpp</h1><a href="XmlReader_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment">LASS (additive sound synthesis library)</span>
00003 <span class="comment">Copyright (C) 2005  Sever Tipei (s-tipei@uiuc.edu)</span>
00004 <span class="comment"></span>
00005 <span class="comment">This program is free software; you can redistribute it and/or</span>
00006 <span class="comment">modify it under the terms of the GNU General Public License</span>
00007 <span class="comment">as published by the Free Software Foundation; either version 2</span>
00008 <span class="comment">of the License, or (at your option) any later version.</span>
00009 <span class="comment"></span>
00010 <span class="comment">This program is distributed in the hope that it will be useful,</span>
00011 <span class="comment">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00012 <span class="comment">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00013 <span class="comment">GNU General Public License for more details.</span>
00014 <span class="comment"></span>
00015 <span class="comment">You should have received a copy of the GNU General Public License</span>
00016 <span class="comment">along with this program; if not, write to the Free Software</span>
00017 <span class="comment">Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.</span>
00018 <span class="comment">*/</span>
00019 
00020 <span class="comment">//----------------------------------------------------------------------------//</span>
00021 <span class="comment">//</span>
00022 <span class="comment">//      XmlReader.cpp</span>
00023 <span class="comment">//----------------------------------------------------------------------------//</span>
00024 <span class="preprocessor">#ifndef __XML_READER_CPP</span>
00025 <span class="preprocessor"></span><span class="preprocessor">#define __XML_READER_CPP</span>
00026 <span class="preprocessor"></span>
00027 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00028 <span class="preprocessor">#include &lt;string.h&gt;</span>
00029 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00030 <span class="preprocessor">#include "<a class="code" href="XmlReader_8h.html">XmlReader.h</a>"</span>
00031 
00032 <span class="comment">//----------------------------------------------------------------------------//</span>
<a name="l00033"></a><a class="code" href="classXmlReader_1_1tagparam.html#a0">00033</a> <a class="code" href="classXmlReader_1_1tagparam.html#a0">XmlReader::tagparam::tagparam</a>(<span class="keywordtype">char</span> *n, <span class="keywordtype">char</span> *v)
00034 {
00035         <a class="code" href="classXmlReader_1_1tagparam.html#o0">name</a>=<span class="keyword">new</span> <span class="keywordtype">char</span>[strlen(n)+1];
00036         strcpy(<a class="code" href="classXmlReader_1_1tagparam.html#o0">name</a>,n);
00037         <span class="keywordflow">if</span>(v)
00038         {
00039                 <a class="code" href="classXmlReader_1_1tagparam.html#o1">value</a>=<span class="keyword">new</span> <span class="keywordtype">char</span>[strlen(v)+1];
00040                 strcpy(<a class="code" href="classXmlReader_1_1tagparam.html#o1">value</a>,v);
00041         }
00042         <span class="keywordflow">else</span>
00043                 <a class="code" href="classXmlReader_1_1tagparam.html#o1">value</a>=NULL;
00044 
00045         <a class="code" href="classXmlReader_1_1tagparam.html#o2">next</a>=NULL;
00046 }
00047 
00048 <span class="comment">//----------------------------------------------------------------------------//</span>
<a name="l00049"></a><a class="code" href="classXmlReader_1_1tagparam.html#a1">00049</a> <a class="code" href="classXmlReader_1_1tagparam.html#a1">XmlReader::tagparam::~tagparam</a>()
00050 {
00051         <span class="keywordflow">if</span>(<a class="code" href="classXmlReader_1_1tagparam.html#o0">name</a>)
00052                 <span class="keyword">delete</span>[] <a class="code" href="classXmlReader_1_1tagparam.html#o0">name</a>;
00053 
00054         <span class="keywordflow">if</span>(<a class="code" href="classXmlReader_1_1tagparam.html#o1">value</a>)
00055                 <span class="keyword">delete</span>[] <a class="code" href="classXmlReader_1_1tagparam.html#o1">value</a>;
00056 
00057         <span class="comment">// Recurse and delete</span>
00058         <span class="keywordflow">if</span>(<a class="code" href="classXmlReader_1_1tagparam.html#o2">next</a>)
00059                 <span class="keyword">delete</span> <a class="code" href="classXmlReader_1_1tagparam.html#o2">next</a>;
00060 }
00061 
00062 <span class="comment">//----------------------------------------------------------------------------//</span>
<a name="l00063"></a><a class="code" href="classXmlReader_1_1xmltag.html#a2">00063</a> <span class="keywordtype">void</span> <a class="code" href="classXmlReader_1_1xmltag.html#a2">XmlReader::xmltag::setName</a>(<span class="keywordtype">char</span> *in)
00064 {
00065         <a class="code" href="classXmlReader_1_1xmltag.html#o0">name</a>=<span class="keyword">new</span> <span class="keywordtype">char</span>[strlen(in)+1];
00066         strcpy(<a class="code" href="classXmlReader_1_1xmltag.html#o0">name</a>,in);
00067 }
00068 
00069 <span class="comment">//----------------------------------------------------------------------------//</span>
<a name="l00070"></a><a class="code" href="classXmlReader_1_1xmltag.html#a0">00070</a> <a class="code" href="classXmlReader_1_1xmltag.html#a0">XmlReader::xmltag::xmltag</a>()
00071 {
00072         <a class="code" href="classXmlReader_1_1xmltag.html#o0">name</a>=NULL;
00073         <a class="code" href="classXmlReader_1_1xmltag.html#o1">params</a>=NULL;
00074         <a class="code" href="classXmlReader_1_1xmltag.html#o2">isClosing</a>=<span class="keyword">false</span>;
00075         <a class="code" href="classXmlReader_1_1xmltag.html#o3">children</a>=<span class="keyword">new</span> <a class="code" href="classXmlReader_1_1xmltagset.html">xmltagset</a>;
00076 }
00077 
00078 <span class="comment">//----------------------------------------------------------------------------//</span>
<a name="l00079"></a><a class="code" href="classXmlReader_1_1xmltag.html#a1">00079</a> <a class="code" href="classXmlReader_1_1xmltag.html#a1">XmlReader::xmltag::~xmltag</a>()
00080 {
00081         <a class="code" href="classXmlReader_1_1xmltag.html#b1">destroyTag</a>();
00082 }
00083 
00084 <span class="comment">//----------------------------------------------------------------------------//</span>
<a name="l00085"></a><a class="code" href="classXmlReader_1_1xmltag.html#b0">00085</a> <a class="code" href="classXmlReader_1_1tagparam.html">XmlReader::tagparam</a>* <a class="code" href="classXmlReader_1_1xmltag.html#b0">XmlReader::xmltag::findParam</a>(<span class="keywordtype">char</span> *pname)
00086 {
00087         <a class="code" href="classXmlReader_1_1tagparam.html">tagparam</a> *tp=<a class="code" href="classXmlReader_1_1xmltag.html#o1">params</a>;
00088         <span class="keywordflow">while</span>(tp!=NULL)
00089         {
00090                 <span class="keywordflow">if</span>(!strcasecmp(tp-&gt;<a class="code" href="classXmlReader_1_1tagparam.html#o0">name</a>,pname))
00091                         <span class="keywordflow">return</span> tp;
00092 
00093                 tp=tp-&gt;<a class="code" href="classXmlReader_1_1tagparam.html#o2">next</a>;
00094         }
00095         <span class="keywordflow">return</span> NULL;
00096 }
00097 
00098 <span class="comment">//----------------------------------------------------------------------------//</span>
<a name="l00099"></a><a class="code" href="classXmlReader_1_1xmltag.html#a3">00099</a> <span class="keywordtype">char</span>* <a class="code" href="classXmlReader_1_1xmltag.html#a3">XmlReader::xmltag::getParamValue</a>(<span class="keywordtype">char</span> *pname)
00100 {
00101         <a class="code" href="classXmlReader_1_1tagparam.html">tagparam</a> *tp=<a class="code" href="classXmlReader_1_1xmltag.html#b0">findParam</a>(pname);
00102         <span class="keywordflow">if</span>(!tp)
00103                 <span class="keywordflow">return</span> NULL;
00104 
00105         <span class="keywordflow">return</span> tp-&gt;<a class="code" href="classXmlReader_1_1tagparam.html#o1">value</a>;
00106 }
00107 
00108 <span class="comment">//----------------------------------------------------------------------------//</span>
<a name="l00109"></a><a class="code" href="classXmlReader_1_1xmltag.html#a4">00109</a> <span class="keywordtype">bool</span> <a class="code" href="classXmlReader_1_1xmltag.html#a4">XmlReader::xmltag::isParamDefined</a>(<span class="keywordtype">char</span> *pname)
00110 {
00111         <a class="code" href="classXmlReader_1_1tagparam.html">tagparam</a> *tp=<a class="code" href="classXmlReader_1_1xmltag.html#b0">findParam</a>(pname);
00112         <span class="keywordflow">if</span>(!tp)
00113                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00114 
00115         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00116 }
00117 
00118 <span class="comment">//----------------------------------------------------------------------------//</span>
<a name="l00119"></a><a class="code" href="classXmlReader_1_1xmltag.html#b1">00119</a> <span class="keywordtype">void</span> <a class="code" href="classXmlReader_1_1xmltag.html#b1">XmlReader::xmltag::destroyTag</a>()
00120 {
00121         <span class="keywordflow">if</span>(<a class="code" href="classXmlReader_1_1xmltag.html#o0">name</a>)
00122                 <span class="keyword">delete</span>[] <a class="code" href="classXmlReader_1_1xmltag.html#o0">name</a>;
00123 
00124         <a class="code" href="classXmlReader_1_1tagparam.html">tagparam</a> *tp=<a class="code" href="classXmlReader_1_1xmltag.html#o1">params</a>;
00125         <span class="keywordflow">while</span>(tp)
00126         {
00127                 <a class="code" href="classXmlReader_1_1tagparam.html">tagparam</a> *next=tp-&gt;<a class="code" href="classXmlReader_1_1tagparam.html#o2">next</a>;
00128                 <span class="keyword">delete</span> tp;
00129                 tp=next;
00130         }
00131 
00132         <span class="keyword">delete</span> <a class="code" href="classXmlReader_1_1xmltag.html#o3">children</a>;
00133 
00134         <a class="code" href="classXmlReader_1_1xmltag.html#o0">name</a>=NULL;
00135         params=NULL;
00136         <a class="code" href="classXmlReader_1_1xmltag.html#o2">isClosing</a>=<span class="keyword">false</span>;
00137 
00138         <a class="code" href="classXmlReader_1_1xmltag.html#o3">children</a>=<span class="keyword">new</span> <a class="code" href="classXmlReader_1_1xmltagset.html">xmltagset</a>;
00139 
00140 }
00141 
00142 <span class="comment">//----------------------------------------------------------------------------//</span>
<a name="l00143"></a><a class="code" href="classXmlReader_1_1xmltag.html#a5">00143</a> <span class="keywordtype">char</span>* <a class="code" href="classXmlReader_1_1xmltag.html#a5">XmlReader::xmltag::findChildParamValue</a>(<span class="keywordtype">char</span> *childName,<span class="keywordtype">char</span> *paramName)
00144 {
00145         <a class="code" href="classXmlReader_1_1xmltag.html">xmltag</a> *child=<a class="code" href="classXmlReader_1_1xmltag.html#o3">children</a>-&gt;<a class="code" href="classXmlReader_1_1xmltagset.html#a3">find</a>(childName);
00146         <span class="keywordflow">if</span>(!child)
00147                 <span class="keywordflow">return</span> NULL;
00148 
00149         <span class="keywordflow">return</span> child-&gt;<a class="code" href="classXmlReader_1_1xmltag.html#a3">getParamValue</a>(paramName);
00150 }
00151 
00152 <span class="comment">//----------------------------------------------------------------------------//</span>
<a name="l00153"></a><a class="code" href="classXmlReader_1_1xmltagset.html#a0">00153</a> <a class="code" href="classXmlReader_1_1xmltagset.html#a0">XmlReader::xmltagset::xmltagset</a>()
00154 {
00155         <a class="code" href="classXmlReader_1_1xmltagset.html#o0">tag</a>=NULL;
00156         <a class="code" href="classXmlReader_1_1xmltagset.html#o1">next</a>=NULL;
00157         <a class="code" href="classXmlReader_1_1xmltagset.html#p0">curSearch</a>=NULL;
00158         <a class="code" href="classXmlReader_1_1xmltagset.html#p1">searchName</a>=NULL;
00159 }
00160 
00161 
<a name="l00162"></a><a class="code" href="classXmlReader_1_1xmltagset.html#a1">00162</a> <a class="code" href="classXmlReader_1_1xmltagset.html#a1">XmlReader::xmltagset::~xmltagset</a>()
00163 {
00164         <span class="comment">// Delete the tag</span>
00165         <span class="keywordflow">if</span>(<a class="code" href="classXmlReader_1_1xmltagset.html#o0">tag</a>)
00166                 <span class="keyword">delete</span> <a class="code" href="classXmlReader_1_1xmltagset.html#o0">tag</a>;
00167 
00168         <span class="comment">// Recurse and delete</span>
00169         <span class="keywordflow">if</span>(<a class="code" href="classXmlReader_1_1xmltagset.html#o1">next</a>)
00170                 <span class="keyword">delete</span> <a class="code" href="classXmlReader_1_1xmltagset.html#o1">next</a>;
00171 }
00172 
00173 <span class="comment">//----------------------------------------------------------------------------//</span>
<a name="l00174"></a><a class="code" href="classXmlReader_1_1xmltagset.html#a2">00174</a> <span class="keywordtype">void</span> <a class="code" href="classXmlReader_1_1xmltagset.html#a2">XmlReader::xmltagset::add</a>(<a class="code" href="classXmlReader_1_1xmltag.html">xmltag</a> *itag)
00175 {
00176         <span class="keywordflow">if</span>(!<a class="code" href="classXmlReader_1_1xmltagset.html#o0">tag</a>)
00177         {
00178                 <a class="code" href="classXmlReader_1_1xmltagset.html#o0">tag</a>=itag;
00179                 <span class="keywordflow">return</span>;
00180         }
00181         <a class="code" href="classXmlReader_1_1xmltagset.html">xmltagset</a> *set=<span class="keyword">this</span>;
00182         <span class="keywordflow">while</span>(set-&gt;<a class="code" href="classXmlReader_1_1xmltagset.html#o1">next</a>)
00183                 set=set-&gt;<a class="code" href="classXmlReader_1_1xmltagset.html#o1">next</a>;
00184 
00185         set-&gt;<a class="code" href="classXmlReader_1_1xmltagset.html#o1">next</a>=<span class="keyword">new</span> <a class="code" href="classXmlReader_1_1xmltagset.html">xmltagset</a>;
00186         set-&gt;<a class="code" href="classXmlReader_1_1xmltagset.html#o1">next</a>-&gt;<a class="code" href="classXmlReader_1_1xmltagset.html#o0">tag</a>=itag;    
00187 }
00188 
00189 <span class="comment">//----------------------------------------------------------------------------//</span>
<a name="l00190"></a><a class="code" href="classXmlReader_1_1xmltagset.html#a3">00190</a> <a class="code" href="classXmlReader_1_1xmltag.html">XmlReader::xmltag</a>* <a class="code" href="classXmlReader_1_1xmltagset.html#a3">XmlReader::xmltagset::find</a>(<span class="keywordtype">char</span> *name)
00191 {
00192         <a class="code" href="classXmlReader_1_1xmltag.html">xmltag</a> *<a class="code" href="classXmlReader_1_1xmltagset.html#o0">tag</a>;
00193         <span class="keywordflow">if</span>(<a class="code" href="classXmlReader_1_1xmltagset.html#p1">searchName</a>)
00194         {
00195                 <span class="keywordflow">if</span>(!strcmp(<a class="code" href="classXmlReader_1_1xmltagset.html#p1">searchName</a>,name))
00196                 {
00197                         tag=<a class="code" href="classXmlReader_1_1xmltagset.html#b0">auxfind</a>(<a class="code" href="classXmlReader_1_1xmltagset.html#p0">curSearch</a>,name);
00198                         <span class="keywordflow">if</span>(!tag)
00199                         {
00200                                 <a class="code" href="classXmlReader_1_1xmltagset.html#p0">curSearch</a>=NULL;
00201                                 <a class="code" href="classXmlReader_1_1xmltagset.html#p1">searchName</a>=NULL;
00202                                 <span class="keywordflow">return</span> NULL;
00203                         }
00204                         <span class="keywordflow">return</span> tag;
00205                 }       
00206         }
00207 
00208         <a class="code" href="classXmlReader_1_1xmltagset.html#p1">searchName</a>=name;
00209         tag=<a class="code" href="classXmlReader_1_1xmltagset.html#b0">auxfind</a>(<span class="keyword">this</span>,name);
00210         <span class="keywordflow">if</span>(!tag)
00211         {       
00212                 <a class="code" href="classXmlReader_1_1xmltagset.html#p1">searchName</a>=NULL;
00213                 <a class="code" href="classXmlReader_1_1xmltagset.html#p0">curSearch</a>=NULL;
00214                 <span class="keywordflow">return</span> NULL;
00215         }
00216         <span class="keywordflow">return</span> tag;
00217 }
00218 
00219 <span class="comment">//----------------------------------------------------------------------------//</span>
<a name="l00220"></a><a class="code" href="classXmlReader_1_1xmltagset.html#b0">00220</a> <a class="code" href="classXmlReader_1_1xmltag.html">XmlReader::xmltag</a>* <a class="code" href="classXmlReader_1_1xmltagset.html#b0">XmlReader::xmltagset::auxfind</a>(<a class="code" href="classXmlReader_1_1xmltagset.html">xmltagset</a> *set, <span class="keywordtype">char</span> *name)
00221 {
00222         <span class="keywordflow">if</span>(!set)
00223                 <span class="keywordflow">return</span> NULL;
00224         <span class="keywordflow">if</span>(!set-&gt;<a class="code" href="classXmlReader_1_1xmltagset.html#o0">tag</a>)
00225                 <span class="keywordflow">return</span> NULL;
00226 
00227         <span class="keywordflow">if</span>(!strcmp(name,set-&gt;<a class="code" href="classXmlReader_1_1xmltagset.html#o0">tag</a>-&gt;<a class="code" href="classXmlReader_1_1xmltag.html#o0">name</a>))
00228         {
00229                 <a class="code" href="classXmlReader_1_1xmltagset.html#p0">curSearch</a>=set-&gt;<a class="code" href="classXmlReader_1_1xmltagset.html#o1">next</a>;
00230                 <span class="keywordflow">return</span> set-&gt;<a class="code" href="classXmlReader_1_1xmltagset.html#o0">tag</a>;
00231         }
00232         <span class="keywordflow">return</span> <a class="code" href="classXmlReader_1_1xmltagset.html#b0">auxfind</a>(set-&gt;<a class="code" href="classXmlReader_1_1xmltagset.html#o1">next</a>,name);
00233 }
00234 
00235 
00236 <span class="comment">//----------------------------------------------------------------------------//</span>
<a name="l00237"></a><a class="code" href="classXmlReader.html#a0">00237</a> <a class="code" href="classXmlReader.html#a0">XmlReader::XmlReader</a>()
00238 {
00239         <a class="code" href="classXmlReader.html#p0">fp</a>=NULL;
00240         <a class="code" href="classXmlReader.html#p1">inputbuffer</a>=<span class="keyword">new</span> <span class="keywordtype">char</span>[<a class="code" href="XmlReader_8h.html#a0">XML_BUFFER_SIZE</a>];
00241         <a class="code" href="classXmlReader.html#p2">tagbuffer</a>=<span class="keyword">new</span> <span class="keywordtype">char</span>[<a class="code" href="XmlReader_8h.html#a0">XML_BUFFER_SIZE</a>];
00242         <a class="code" href="classXmlReader.html#p3">nibuf</a>=0;
00243         memset(<a class="code" href="classXmlReader.html#p1">inputbuffer</a>,0,<a class="code" href="XmlReader_8h.html#a0">XML_BUFFER_SIZE</a>);
00244         memset(<a class="code" href="classXmlReader.html#p2">tagbuffer</a>,0,<a class="code" href="XmlReader_8h.html#a0">XML_BUFFER_SIZE</a>);
00245 }
00246 
00247 <span class="comment">//----------------------------------------------------------------------------//</span>
<a name="l00248"></a><a class="code" href="classXmlReader.html#a1">00248</a> <a class="code" href="classXmlReader.html#a1">XmlReader::~XmlReader</a>()
00249 {
00250         <a class="code" href="classXmlReader.html#a3">closeFile</a>();
00251 
00252         <span class="keyword">delete</span>[] <a class="code" href="classXmlReader.html#p1">inputbuffer</a>;
00253         <span class="keyword">delete</span>[] <a class="code" href="classXmlReader.html#p2">tagbuffer</a>;
00254 }
00255 
00256 <span class="comment">//----------------------------------------------------------------------------//</span>
<a name="l00257"></a><a class="code" href="classXmlReader.html#a2">00257</a> <span class="keywordtype">bool</span> <a class="code" href="classXmlReader.html#a2">XmlReader::openFile</a>(<span class="keywordtype">char</span> *file)
00258 {
00259         <span class="keywordflow">if</span>(<a class="code" href="classXmlReader.html#p0">fp</a>)
00260                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00261         
00262         <a class="code" href="classXmlReader.html#p0">fp</a>=fopen(file,<span class="stringliteral">"r"</span>);
00263         <span class="keywordflow">if</span>(!<a class="code" href="classXmlReader.html#p0">fp</a>)
00264                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00265 
00266         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00267 }
00268 
00269 <span class="comment">//----------------------------------------------------------------------------//</span>
<a name="l00270"></a><a class="code" href="classXmlReader.html#a3">00270</a> <span class="keywordtype">bool</span> <a class="code" href="classXmlReader.html#a3">XmlReader::closeFile</a>()
00271 {
00272         <span class="keywordflow">if</span>(<a class="code" href="classXmlReader.html#p0">fp</a>)
00273         {
00274                 fclose(<a class="code" href="classXmlReader.html#p0">fp</a>);
00275                 <a class="code" href="classXmlReader.html#p0">fp</a>=NULL;
00276                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00277         }
00278 
00279         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00280 }
00281 
00282 <span class="comment">//----------------------------------------------------------------------------//</span>
<a name="l00283"></a><a class="code" href="classXmlReader.html#b1">00283</a> <span class="keywordtype">void</span> <a class="code" href="classXmlReader.html#b1">XmlReader::dewhitespace</a>(<span class="keywordtype">char</span> *c)
00284 {
00285         <span class="keywordtype">int</span> l=strlen(c);
00286         <span class="keywordtype">bool</span> wsok=<span class="keyword">false</span>;
00287         <span class="keywordtype">int</span> nl=0;
00288 
00289         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;l;i++)
00290         {
00291                 <span class="keywordflow">if</span>(c[i]==<span class="charliteral">' '</span> || c[i]==<span class="charliteral">'\t'</span> || c[i]==<span class="charliteral">'\r'</span> || c[i]==<span class="charliteral">'\n'</span>)
00292                 {
00293                         <span class="keywordflow">if</span>(wsok)
00294                         {
00295                                 c[nl]=<span class="charliteral">' '</span>;
00296                                 nl++;
00297                                 wsok=<span class="keyword">false</span>;
00298                         }
00299                         <span class="keywordflow">else</span>
00300                                 <span class="keywordflow">continue</span>;
00301                 }
00302                 <span class="keywordflow">else</span>
00303                 {
00304                         c[nl]=c[i];
00305                         nl++;
00306                         wsok=<span class="keyword">true</span>;
00307                 }
00308         }
00309         c[nl]=0;
00310 }
00311 
00312 <span class="comment">//----------------------------------------------------------------------------//</span>
<a name="l00313"></a><a class="code" href="classXmlReader.html#b0">00313</a> <span class="keywordtype">bool</span> <a class="code" href="classXmlReader.html#b0">XmlReader::fillTagBuffer</a>()
00314 {
00315         <span class="keywordtype">char</span> *start,*end;
00316 
00317         start=index(<a class="code" href="classXmlReader.html#p1">inputbuffer</a>,<span class="charliteral">'&lt;'</span>);
00318         end=index(<a class="code" href="classXmlReader.html#p1">inputbuffer</a>,<span class="charliteral">'&gt;'</span>);
00319 
00320         <span class="comment">// Lets find a tag!</span>
00321         <span class="keywordflow">if</span>(!start)
00322         {
00323                 <span class="keywordflow">while</span>(!start)
00324                 {
00325 <span class="preprocessor">                        #ifdef XML_DEBUG</span>
00326 <span class="preprocessor"></span>                        printf(<span class="stringliteral">"[%s:%d] Recycling buffer\n"</span>,__FILE__,__LINE__);
00327 <span class="preprocessor">                        #endif</span>
00328 <span class="preprocessor"></span>
00329                         <span class="comment">// Effectively dump the buffer, grab new data</span>
00330                         <span class="keywordflow">if</span>(!fgets(<a class="code" href="classXmlReader.html#p1">inputbuffer</a>,<a class="code" href="XmlReader_8h.html#a0">XML_BUFFER_SIZE</a>-<a class="code" href="classXmlReader.html#p3">nibuf</a>,<a class="code" href="classXmlReader.html#p0">fp</a>))
00331                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00332                 
00333                         start=index(<a class="code" href="classXmlReader.html#p1">inputbuffer</a>,<span class="charliteral">'&lt;'</span>);
00334                 }
00335 
00336                 <a class="code" href="classXmlReader.html#p3">nibuf</a>=strlen(<a class="code" href="classXmlReader.html#p1">inputbuffer</a>);
00337                 end=index(<a class="code" href="classXmlReader.html#p1">inputbuffer</a>,<span class="charliteral">'&gt;'</span>);
00338         }
00339         
00340         <span class="keywordflow">while</span>(!end)
00341         {
00342 <span class="preprocessor">                #ifdef XML_DEBUG</span>
00343 <span class="preprocessor"></span>                printf(<span class="stringliteral">"[%s:%d] Adding to buffer\n"</span>,__FILE__,__LINE__);
00344 <span class="preprocessor">                #endif</span>
00345 <span class="preprocessor"></span>
00346                 <span class="comment">// What if nibuf&gt;XML_BUFFER_SIZE?</span>
00347                 <span class="keywordflow">if</span>(!fgets(<a class="code" href="classXmlReader.html#p1">inputbuffer</a>+<a class="code" href="classXmlReader.html#p3">nibuf</a>,<a class="code" href="XmlReader_8h.html#a0">XML_BUFFER_SIZE</a>-nibuf,<a class="code" href="classXmlReader.html#p0">fp</a>))
00348                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00349                 
00350                 nibuf=strlen(<a class="code" href="classXmlReader.html#p1">inputbuffer</a>);
00351                 end=index(<a class="code" href="classXmlReader.html#p1">inputbuffer</a>,<span class="charliteral">'&gt;'</span>);
00352         }
00353         
00354         <span class="comment">// okay, now have and end and a beginning pointer, and a valid nibuf</span>
00355         <span class="comment">// that is the buffered amount of data we currently have</span>
00356         
00357 <span class="preprocessor">        #ifdef XML_DEBUG</span>
00358 <span class="preprocessor"></span>        <span class="comment">// perform sanity checks</span>
00359         <span class="keywordflow">if</span>(start&gt;=end)
00360                 printf(<span class="stringliteral">"[%s:%d] FAIL! Start: %X, End: %X, nibuf: %d\n"</span>,__FILE__,__LINE__,start,end,<a class="code" href="classXmlReader.html#p3">nibuf</a>);
00361 
00362         <span class="keywordflow">if</span>(start&lt;<a class="code" href="classXmlReader.html#p1">inputbuffer</a> || end&lt;<a class="code" href="classXmlReader.html#p1">inputbuffer</a>)
00363                 printf(<span class="stringliteral">"[%s:%d] FAIL! Start: %X, End: %X, nibuf: %d\n"</span>,__FILE__,__LINE__,start,end,<a class="code" href="classXmlReader.html#p3">nibuf</a>);
00364 
00365         <span class="keywordflow">if</span>(<a class="code" href="classXmlReader.html#p3">nibuf</a>&gt;<a class="code" href="XmlReader_8h.html#a0">XML_BUFFER_SIZE</a> || <a class="code" href="classXmlReader.html#p3">nibuf</a>&lt;0)
00366                 printf(<span class="stringliteral">"[%s:%d] FAIL! Start: %X, End: %X, nibuf: %d\n"</span>,__FILE__,__LINE__,start,end,<a class="code" href="classXmlReader.html#p3">nibuf</a>);
00367 
00368 <span class="preprocessor">        #endif</span>
00369 <span class="preprocessor"></span>
00370         memcpy(<a class="code" href="classXmlReader.html#p2">tagbuffer</a>,start,end-start+1);
00371         memmove(<a class="code" href="classXmlReader.html#p1">inputbuffer</a>,end+1,<a class="code" href="classXmlReader.html#p3">nibuf</a>-(end-<a class="code" href="classXmlReader.html#p1">inputbuffer</a>)+1);
00372 
00373         <a class="code" href="classXmlReader.html#p3">nibuf</a>-=end-<a class="code" href="classXmlReader.html#p1">inputbuffer</a>+1;
00374 
00375         <a class="code" href="classXmlReader.html#p2">tagbuffer</a>[end-start+1]=0;
00376         <a class="code" href="classXmlReader.html#b1">dewhitespace</a>(<a class="code" href="classXmlReader.html#p2">tagbuffer</a>);
00377 
00378         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00379 }
00380 
00381 <span class="comment">//----------------------------------------------------------------------------//</span>
00382 <span class="comment">// This is the tag parser.</span>
00383 <span class="comment">// It admittedly is not very good.</span>
00384 <span class="comment">// There are known issues with it, some formatting can break it.</span>
00385 <span class="comment">// Time was not spent to fix them because lass never really required it.</span>
00386 <span class="comment">// In other words, this is a pretty "lass specific" reader insteead of a</span>
00387 <span class="comment">// general purpose reader.</span>
00388 <span class="comment">//</span>
00389 <span class="comment">// A space within a value in a tag parameter is a problem:</span>
00390 <span class="comment">//  OKAY: &lt;tag param='value'&gt;</span>
00391 <span class="comment">//  UHOH: &lt;tag param='val ue'&gt;</span>
<a name="l00392"></a><a class="code" href="classXmlReader.html#a4">00392</a> <span class="keywordtype">bool</span> <a class="code" href="classXmlReader.html#a4">XmlReader::readTag</a>(<a class="code" href="classXmlReader_1_1xmltag.html">xmltag</a> *tag)
00393 {
00394         <span class="comment">//xmltag *tag=new xmltag;</span>
00395         tag-&gt;<a class="code" href="classXmlReader_1_1xmltag.html#b1">destroyTag</a>();
00396         
00397         <span class="keywordflow">if</span>(!<a class="code" href="classXmlReader.html#b0">fillTagBuffer</a>())
00398                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00399 
00400         <span class="keywordtype">char</span> *tagstart=index(<a class="code" href="classXmlReader.html#p2">tagbuffer</a>,<span class="charliteral">'&lt;'</span>)+1;
00401 
00402         <span class="comment">// HACK</span>
00403         <span class="comment">// Since Xerces doesn't put a space before the closing tag slash</span>
00404         <span class="comment">// (&lt;tag/&gt; instead of &lt;tag /&gt;), this checks for the closing condition</span>
00405         <span class="comment">// and should make both occasions work.</span>
00406         <span class="comment">// Check for /&gt;, and make / a &gt; and &gt; null.</span>
00407         <span class="keywordtype">char</span> *end=index(tagstart,<span class="charliteral">'&gt;'</span>)-1;
00408         <span class="keywordflow">if</span>(end[0]==<span class="charliteral">'/'</span>)
00409         {
00410                 tag-&gt;<a class="code" href="classXmlReader_1_1xmltag.html#o2">isClosing</a>=<span class="keyword">true</span>;
00411                 end[0]=<span class="charliteral">'&gt;'</span>;
00412                 end[1]=0;
00413         }
00414 
00415         <span class="keywordtype">char</span> *n=strtok(tagstart,<span class="stringliteral">" &gt;"</span>);  
00416         <span class="keywordflow">if</span>(n[0]==<span class="charliteral">'/'</span>)
00417         {
00418                 tag-&gt;<a class="code" href="classXmlReader_1_1xmltag.html#a2">setName</a>(n+1);
00419                 tag-&gt;<a class="code" href="classXmlReader_1_1xmltag.html#o2">isClosing</a>=<span class="keyword">true</span>;
00420         }
00421         <span class="keywordflow">else</span>
00422                 tag-&gt;<a class="code" href="classXmlReader_1_1xmltag.html#a2">setName</a>(n);
00423 
00424         <a class="code" href="classXmlReader_1_1tagparam.html">tagparam</a> *tp=NULL;
00425         <span class="keywordflow">while</span>(n=strtok(NULL,<span class="stringliteral">" &gt;"</span>))
00426         {
00427                 <span class="keywordflow">if</span>(!strcmp(n,<span class="stringliteral">"/"</span>))
00428                 {
00429                         tag-&gt;<a class="code" href="classXmlReader_1_1xmltag.html#o2">isClosing</a>=<span class="keyword">true</span>;
00430                 }
00431                 <span class="comment">// Dont even try and figure out what a blank space is</span>
00432                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(n,<span class="stringliteral">" "</span>))
00433                         <span class="keywordflow">continue</span>;
00434                 <span class="keywordflow">else</span>
00435                 {
00436                         <span class="keywordtype">char</span> *eq=index(n,<span class="charliteral">'='</span>);
00437                         <span class="keywordflow">if</span>(eq==NULL)
00438                                 tp=<span class="keyword">new</span> <a class="code" href="classXmlReader_1_1tagparam.html">tagparam</a>(n,NULL);
00439                         <span class="keywordflow">else</span>
00440                         {
00441                                 eq[0]=0;
00442                                 <span class="keywordflow">if</span>(eq[1]==<span class="charliteral">'\"'</span> || eq[1]==<span class="charliteral">'\''</span>)
00443                                 {
00444                                         <span class="keywordtype">char</span> *eqend=eq+strlen(eq+1);
00445                                         <span class="keywordflow">if</span>(eqend[0]==<span class="charliteral">'\"'</span> || eqend[0]==<span class="charliteral">'\''</span>)
00446                                                 eqend[0]=0;
00447                                         <span class="keywordflow">else</span>
00448                                         {
00449 <span class="preprocessor">                                                #ifdef XML_DEBUG</span>
00450 <span class="preprocessor"></span>                                                printf(<span class="stringliteral">"Warning: No closequote found on parameter for %s\n"</span>,n);
00451 <span class="preprocessor">                                                #endif</span>
00452 <span class="preprocessor"></span>                                        }
00453                                         tp=<span class="keyword">new</span> tagparam(n,eq+2);
00454                                 }
00455                                 <span class="keywordflow">else</span>
00456                                 {
00457 <span class="preprocessor">                                        #ifdef XML_DEBUG</span>
00458 <span class="preprocessor"></span>                                        printf(<span class="stringliteral">"Warning: No openquote found on parameter for %s\n"</span>,n);
00459 <span class="preprocessor">                                        #endif</span>
00460 <span class="preprocessor"></span>                                        tp=<span class="keyword">new</span> tagparam(n,eq+1);
00461                                 }
00462                         }
00463                         tp-&gt;<a class="code" href="classXmlReader_1_1tagparam.html#o2">next</a>=tag-&gt;<a class="code" href="classXmlReader_1_1xmltag.html#o1">params</a>;
00464                         tag-&gt;<a class="code" href="classXmlReader_1_1xmltag.html#o1">params</a>=tp;
00465                 }
00466         }
00467         
00468         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00469                 
00470 }
00471 <span class="comment">//----------------------------------------------------------------------------//</span>
00472 
<a name="l00473"></a><a class="code" href="classXmlReader.html#a5">00473</a> <a class="code" href="classXmlReader_1_1xmltagset.html">XmlReader::xmltagset</a>* <a class="code" href="classXmlReader.html#a5">XmlReader::readXMLDocument</a>()
00474 {
00475         <span class="comment">//xmltagset *set=new xmltagset;</span>
00476 
00477         <a class="code" href="classXmlReader_1_1xmltag.html">xmltag</a> *tag=<span class="keyword">new</span> <a class="code" href="classXmlReader_1_1xmltag.html">xmltag</a>;
00478         tag-&gt;<a class="code" href="classXmlReader_1_1xmltag.html#o0">name</a>=<span class="stringliteral">"ROOT"</span>;
00479         <a class="code" href="classXmlReader.html#a5">readXMLDocument</a>(tag);
00480         
00481         <span class="keywordflow">return</span> tag-&gt;<a class="code" href="classXmlReader_1_1xmltag.html#o3">children</a>;
00482 }
00483 
<a name="l00484"></a><a class="code" href="classXmlReader.html#a6">00484</a> <span class="keywordtype">void</span> <a class="code" href="classXmlReader.html#a5">XmlReader::readXMLDocument</a>(<a class="code" href="classXmlReader_1_1xmltag.html">XmlReader::xmltag</a> *tag)
00485 {
00486         <a class="code" href="classXmlReader_1_1xmltag.html">xmltag</a> *ctag=<span class="keyword">new</span> <a class="code" href="classXmlReader_1_1xmltag.html">xmltag</a>;
00487         <span class="keywordflow">while</span>(<a class="code" href="classXmlReader.html#a4">readTag</a>(ctag))
00488         {
00489                 <span class="keywordflow">if</span>(!ctag-&gt;<a class="code" href="classXmlReader_1_1xmltag.html#o2">isClosing</a>)
00490                 {
00491                         <a class="code" href="classXmlReader.html#a5">readXMLDocument</a>(ctag);
00492                         tag-&gt;<a class="code" href="classXmlReader_1_1xmltag.html#o3">children</a>-&gt;<a class="code" href="classXmlReader_1_1xmltagset.html#a2">add</a>(ctag);
00493                 }
00494                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(ctag-&gt;<a class="code" href="classXmlReader_1_1xmltag.html#o0">name</a>,tag-&gt;<a class="code" href="classXmlReader_1_1xmltag.html#o0">name</a>) &amp;&amp; ctag-&gt;<a class="code" href="classXmlReader_1_1xmltag.html#o2">isClosing</a>)
00495                 {
00496                         tag-&gt;<a class="code" href="classXmlReader_1_1xmltag.html#o3">children</a>-&gt;<a class="code" href="classXmlReader_1_1xmltagset.html#a2">add</a>(ctag);
00497                         <span class="keywordflow">return</span>;
00498                 }
00499                 <span class="keywordflow">else</span>
00500                 {
00501                         tag-&gt;<a class="code" href="classXmlReader_1_1xmltag.html#o3">children</a>-&gt;<a class="code" href="classXmlReader_1_1xmltagset.html#a2">add</a>(ctag);       
00502                 }
00503 
00504                 ctag=<span class="keyword">new</span> xmltag;
00505         }
00506 
00507         <span class="keywordflow">return</span>;
00508 }
00509 
00510 <span class="preprocessor">#endif //__XML_READER_CPP</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Mon Apr 25 13:18:12 2005 for LASS by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
