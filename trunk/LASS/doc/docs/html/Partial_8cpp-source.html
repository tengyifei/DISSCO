<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>LASS: Partial.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>Partial.cpp</h1><a href="Partial_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment">LASS (additive sound synthesis library)</span>
00003 <span class="comment">Copyright (C) 2005  Sever Tipei (s-tipei@uiuc.edu)</span>
00004 <span class="comment"></span>
00005 <span class="comment">This program is free software; you can redistribute it and/or</span>
00006 <span class="comment">modify it under the terms of the GNU General Public License</span>
00007 <span class="comment">as published by the Free Software Foundation; either version 2</span>
00008 <span class="comment">of the License, or (at your option) any later version.</span>
00009 <span class="comment"></span>
00010 <span class="comment">This program is distributed in the hope that it will be useful,</span>
00011 <span class="comment">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00012 <span class="comment">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00013 <span class="comment">GNU General Public License for more details.</span>
00014 <span class="comment"></span>
00015 <span class="comment">You should have received a copy of the GNU General Public License</span>
00016 <span class="comment">along with this program; if not, write to the Free Software</span>
00017 <span class="comment">Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.</span>
00018 <span class="comment">*/</span>
00019 
00020 <span class="comment">//----------------------------------------------------------------------------//</span>
00021 <span class="comment">//</span>
00022 <span class="comment">//      Partial.cpp</span>
00023 <span class="comment">//</span>
00024 <span class="comment">//----------------------------------------------------------------------------//</span>
00025 
00026 <span class="preprocessor">#ifndef __PARTIAL_CPP</span>
00027 <span class="preprocessor"></span><span class="preprocessor">#define __PARTIAL_CPP</span>
00028 <span class="preprocessor"></span>
00029 <span class="comment">//----------------------------------------------------------------------------//</span>
00030 <span class="preprocessor">#include "<a class="code" href="Partial_8h.html">Partial.h</a>"</span>
00031 <span class="preprocessor">#include &lt;cmath&gt;</span>
00032 <span class="preprocessor">#include &lt;ctime&gt;</span>
00033 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00034 
00035 <span class="preprocessor">#include "<a class="code" href="SoundSample_8h.html">SoundSample.h</a>"</span>
00036 <span class="preprocessor">#include "<a class="code" href="Constant_8h.html">Constant.h</a>"</span>
00037 <span class="preprocessor">#include "<a class="code" href="Track_8h.html">Track.h</a>"</span>
00038 <span class="preprocessor">#include "<a class="code" href="Iterator_8h.html">Iterator.h</a>"</span>
00039 
00040 <span class="comment">//----------------------------------------------------------------------------//</span>
<a name="l00041"></a><a class="code" href="classPartial.html#a0">00041</a> <a class="code" href="classPartial.html#a0">Partial::Partial</a>()
00042 {
00043     <span class="comment">// set some default parameters:</span>
00044     <a class="code" href="classParameterLib.html#a4">setParam</a>(<a class="code" href="Partial_8h.html#a19a2">WAVE_TYPE</a>, 0);
00045     <a class="code" href="classParameterLib.html#a4">setParam</a>(<a class="code" href="Partial_8h.html#a19a0">RELATIVE_AMPLITUDE</a>, 1.0);
00046     <a class="code" href="classParameterLib.html#a4">setParam</a>(<a class="code" href="Partial_8h.html#a19a1">PARTIAL_NUM</a>, 1.0);
00047     <a class="code" href="classParameterLib.html#a4">setParam</a>(<a class="code" href="Partial_8h.html#a20a4">WAVE_SHAPE</a>, 1.0);
00048     <a class="code" href="classParameterLib.html#a4">setParam</a>(<a class="code" href="Partial_8h.html#a20a3">FREQUENCY</a>, 440.0);
00049     <a class="code" href="classParameterLib.html#a4">setParam</a>(<a class="code" href="Partial_8h.html#a20a10">LOUDNESS_SCALAR</a>, 1.0);
00050     <span class="comment">//setParam(GLISSANDO_ENV, 1.0); // (no gliss)</span>
00051     <a class="code" href="classParameterLib.html#a4">setParam</a>(<a class="code" href="Partial_8h.html#a20a11">FREQ_ENV</a>, 1.0);  <span class="comment">// nothing applied to change frequency</span>
00052     <span class="comment">//setParam(DETUNING_ENV, 1.0); // (no detuning)</span>
00053     <a class="code" href="classParameterLib.html#a4">setParam</a>(<a class="code" href="Partial_8h.html#a20a13">AMPTRANS_AMP_ENV</a>, 0 ); <span class="comment">//no transients</span>
00054     <a class="code" href="classParameterLib.html#a4">setParam</a>(<a class="code" href="Partial_8h.html#a20a14">AMPTRANS_RATE_ENV</a>, 0 );
00055     <a class="code" href="classParameterLib.html#a4">setParam</a>(<a class="code" href="Partial_8h.html#a20a15">FREQTRANS_AMP_ENV</a>, 0 );
00056     <a class="code" href="classParameterLib.html#a4">setParam</a>(<a class="code" href="Partial_8h.html#a20a16">FREQTRANS_RATE_ENV</a>, 0 );
00057     <a class="code" href="classParameterLib.html#a4">setParam</a>(<a class="code" href="Partial_8h.html#a20a17">AMPTRANS_WIDTH</a>, 1103); 
00058     <a class="code" href="classParameterLib.html#a4">setParam</a>(<a class="code" href="Partial_8h.html#a20a18">FREQTRANS_WIDTH</a>, 1103);
00059 
00060     <a class="code" href="classPartial.html#r0">reverbObj</a> = NULL;
00061 }
00062 
00063 <span class="comment">//----------------------------------------------------------------------------//</span>
<a name="l00064"></a><a class="code" href="classPartial.html#a1">00064</a> <a class="code" href="classTrack.html">Track</a>* <a class="code" href="classPartial.html#a1">Partial::render</a>(<a class="code" href="Types_8h.html#a1">m_sample_count_type</a> sampleCount,
00065                        <a class="code" href="Types_8h.html#a2">m_time_type</a> duration,
00066                        <a class="code" href="Types_8h.html#a4">m_rate_type</a> samplingRate)
00067 {
00068     <span class="comment">// calculate the number of samples needed:</span>
00069     <a class="code" href="Types_8h.html#a1">m_sample_count_type</a> numSamplesToRender = (<a class="code" href="Types_8h.html#a1">m_sample_count_type</a>) (duration * (<a class="code" href="Types_8h.html#a2">m_time_type</a>)samplingRate);
00070     <a class="code" href="Types_8h.html#a1">m_sample_count_type</a> numSamplesTotal;
00071     <span class="keywordflow">if</span>(<a class="code" href="classPartial.html#r0">reverbObj</a> != NULL)
00072         numSamplesTotal = (<a class="code" href="Types_8h.html#a1">m_sample_count_type</a>) ((duration + <a class="code" href="classPartial.html#r0">reverbObj</a>-&gt;<a class="code" href="classReverb.html#a11">getDecay</a>()) * (<a class="code" href="Types_8h.html#a2">m_time_type</a>)samplingRate);
00073     <span class="keywordflow">else</span>
00074         numSamplesTotal = (<a class="code" href="Types_8h.html#a1">m_sample_count_type</a>) (duration * (<a class="code" href="Types_8h.html#a2">m_time_type</a>)samplingRate);
00075 
00076     <span class="comment">// create two SoundSample objects to write to:</span>
00077     <span class="comment">// one for the actuial sound:</span>
00078 <span class="comment">//    SoundSample* waveSample = new SoundSample(numSamplesTotal, samplingRate);</span>
00079     <a class="code" href="classSoundSample.html">SoundSample</a>* waveSample = <span class="keyword">new</span> <a class="code" href="classSoundSample.html">SoundSample</a>(sampleCount, samplingRate);
00080     <span class="comment">// and one to store amplitude data:</span>
00081 <span class="comment">//    SoundSample* ampSample = new SoundSample(numSamplesTotal, samplingRate);</span>
00082     SoundSample* ampSample = <span class="keyword">new</span> SoundSample(sampleCount, samplingRate);
00083 
00084     <span class="comment">// tell each dynamic variable what the DURATION will be:</span>
00085     <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a3">FREQUENCY</a>).<a class="code" href="classDynamicVariable.html#a6">setDuration</a>(duration);
00086     <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a4">WAVE_SHAPE</a>).<a class="code" href="classDynamicVariable.html#a6">setDuration</a>(duration);
00087     <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a5">TREMOLO_AMP</a>).<a class="code" href="classDynamicVariable.html#a6">setDuration</a>(duration);
00088     <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a6">TREMOLO_RATE</a>).<a class="code" href="classDynamicVariable.html#a6">setDuration</a>(duration);
00089     <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a7">VIBRATO_AMP</a>).<a class="code" href="classDynamicVariable.html#a6">setDuration</a>(duration);
00090     <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a8">VIBRATO_RATE</a>).<a class="code" href="classDynamicVariable.html#a6">setDuration</a>(duration);
00091     <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a9">PHASE</a>).<a class="code" href="classDynamicVariable.html#a6">setDuration</a>(duration);
00092     <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a10">LOUDNESS_SCALAR</a>).<a class="code" href="classDynamicVariable.html#a6">setDuration</a>(duration);
00093     <span class="comment">//getParam(FREQUENCY_DEVIATION).setDuration(duration);</span>
00094     <span class="comment">//getParam(GLISSANDO_ENV).setDuration(duration);</span>
00095     <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a11">FREQ_ENV</a>).<a class="code" href="classDynamicVariable.html#a6">setDuration</a>(duration);
00096     <span class="comment">//getParam(DETUNING_ENV).setDuration(duration);</span>
00097     <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a17">AMPTRANS_WIDTH</a>).<a class="code" href="classDynamicVariable.html#a6">setDuration</a>(duration);
00098     <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a18">FREQTRANS_WIDTH</a>).<a class="code" href="classDynamicVariable.html#a6">setDuration</a>(duration);
00099 
00100     <span class="comment">// tell each dynamic variable what the SAMPLING_RATE will be:</span>
00101     <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a3">FREQUENCY</a>).<a class="code" href="classDynamicVariable.html#a8">setSamplingRate</a>(samplingRate);
00102     <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a4">WAVE_SHAPE</a>).<a class="code" href="classDynamicVariable.html#a8">setSamplingRate</a>(samplingRate);
00103     <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a5">TREMOLO_AMP</a>).<a class="code" href="classDynamicVariable.html#a8">setSamplingRate</a>(samplingRate);
00104     <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a6">TREMOLO_RATE</a>).<a class="code" href="classDynamicVariable.html#a8">setSamplingRate</a>(samplingRate);
00105     <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a7">VIBRATO_AMP</a>).<a class="code" href="classDynamicVariable.html#a8">setSamplingRate</a>(samplingRate);
00106     <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a8">VIBRATO_RATE</a>).<a class="code" href="classDynamicVariable.html#a8">setSamplingRate</a>(samplingRate);
00107     <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a9">PHASE</a>).<a class="code" href="classDynamicVariable.html#a8">setSamplingRate</a>(samplingRate);
00108     <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a10">LOUDNESS_SCALAR</a>).<a class="code" href="classDynamicVariable.html#a8">setSamplingRate</a>(samplingRate);
00109     <span class="comment">//getParam(FREQUENCY_DEVIATION).setSamplingRate(samplingRate);</span>
00110     <span class="comment">//getParam(GLISSANDO_ENV).setSamplingRate(samplingRate);</span>
00111     <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a11">FREQ_ENV</a>).<a class="code" href="classDynamicVariable.html#a8">setSamplingRate</a>(samplingRate);
00112     <span class="comment">//getParam(DETUNING_ENV).setSamplingRate(samplingRate);</span>
00113     <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a17">AMPTRANS_WIDTH</a>).<a class="code" href="classDynamicVariable.html#a8">setSamplingRate</a>(samplingRate);
00114     <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a18">FREQTRANS_WIDTH</a>).<a class="code" href="classDynamicVariable.html#a8">setSamplingRate</a>(samplingRate);
00115 
00116     <span class="comment">// randomize the frequency deviation:</span>
00117     <span class="comment">//</span>
00118     <span class="comment">// calculate the variance:</span>
00119     <span class="comment">// grab the frequency at the start of the partial:</span>
00120     <a class="code" href="Types_8h.html#a3">m_value_type</a> base_freq = <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a3">FREQUENCY</a>).<a class="code" href="classDynamicVariable.html#a3">valueIterator</a>().<a class="code" href="classIterator.html#a5">next</a>();
00121     <a class="code" href="Types_8h.html#a3">m_value_type</a> freq_variance = (base_freq / (<a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a19a1">PARTIAL_NUM</a>)+1.0))/2.0;
00122     <span class="comment">//</span>
00123     <span class="comment">// get a random nummber between -1 and 1:</span>
00124     <a class="code" href="Types_8h.html#a3">m_value_type</a> rand = (((<span class="keywordtype">double</span>) random()) / ((<span class="keywordtype">double</span>) RAND_MAX) * 2.0) - 1.0;
00125     <span class="comment">//</span>
00126     <span class="comment">// vary the freq_dev by this value:</span>
00127     <span class="comment">// make a copy of the frequency deviation dynamic variable</span>
00128     <span class="comment">//DynamicVariable* freq_dev = getParam(FREQUENCY_DEVIATION).clone();</span>
00129     <span class="comment">// scale the copy:</span>
00130     <span class="comment">//freq_dev-&gt;scale(rand * freq_variance);</span>
00131     <span class="comment">//</span>
00132     <span class="comment">// make a copy of the glissando dynamic variable</span>
00133    
00134 
00135     <a class="code" href="classDynamicVariable.html">DynamicVariable</a>* frequency_env = <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a3">FREQUENCY</a>).<a class="code" href="classDynamicVariable.html#a2">clone</a>();
00136     frequency_env-&gt;<a class="code" href="classDynamicVariable.html#a6">setDuration</a>(duration);
00137 
00138     <span class="comment">//DynamicVariable* gliss_env = getParam(GLISSANDO_ENV).clone();</span>
00139     <a class="code" href="classDynamicVariable.html">DynamicVariable</a>* freq_env = <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a11">FREQ_ENV</a>).<a class="code" href="classDynamicVariable.html#a2">clone</a>(); 
00140     <span class="comment">//DynamicVariable* detuning_env = getParam(DETUNING_ENV).clone();</span>
00141     <a class="code" href="classDynamicVariable.html">DynamicVariable</a>* amptrans_amp_env = <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a13">AMPTRANS_AMP_ENV</a>).<a class="code" href="classDynamicVariable.html#a2">clone</a>();
00142     <a class="code" href="classDynamicVariable.html">DynamicVariable</a>* amptrans_rate_env = <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a14">AMPTRANS_RATE_ENV</a>).<a class="code" href="classDynamicVariable.html#a2">clone</a>();
00143     <a class="code" href="classDynamicVariable.html">DynamicVariable</a>* freqtrans_amp_env = <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a15">FREQTRANS_AMP_ENV</a>).<a class="code" href="classDynamicVariable.html#a2">clone</a>();
00144     <a class="code" href="classDynamicVariable.html">DynamicVariable</a>* freqtrans_rate_env = <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a16">FREQTRANS_RATE_ENV</a>).<a class="code" href="classDynamicVariable.html#a2">clone</a>();  
00145     <span class="comment">//gliss_env-&gt;setDuration(duration);</span>
00146     freq_env-&gt;<a class="code" href="classDynamicVariable.html#a6">setDuration</a>(duration);
00147     <span class="comment">//detuning_env-&gt;setDuration(duration);</span>
00148     amptrans_amp_env-&gt;<a class="code" href="classDynamicVariable.html#a6">setDuration</a>(duration);
00149     amptrans_rate_env-&gt;<a class="code" href="classDynamicVariable.html#a6">setDuration</a>(duration);
00150     freqtrans_amp_env-&gt;<a class="code" href="classDynamicVariable.html#a6">setDuration</a>(duration);
00151     freqtrans_rate_env-&gt;<a class="code" href="classDynamicVariable.html#a6">setDuration</a>(duration);
00152 
00153     <span class="comment">// grab iterators for each DynamicVariable:</span>
00154     <span class="keyword">typedef</span> <a class="code" href="classIterator.html">Iterator&lt;m_value_type&gt;</a> ValIter;
00155 
00156     <span class="comment">// ValIter freq_it = getParam(FREQUENCY).valueIterator();</span>
00157     <span class="comment">//more messing around</span>
00158     ValIter frequency_it = frequency_env-&gt;<a class="code" href="classDynamicVariable.html#a3">valueIterator</a>();
00159 
00160     ValIter wave_shape_it = <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a4">WAVE_SHAPE</a>).<a class="code" href="classDynamicVariable.html#a3">valueIterator</a>();
00161     ValIter tremolo_amp_it = <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a5">TREMOLO_AMP</a>).<a class="code" href="classDynamicVariable.html#a3">valueIterator</a>();
00162     ValIter tremolo_rate_it = <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a6">TREMOLO_RATE</a>).<a class="code" href="classDynamicVariable.html#a3">valueIterator</a>();
00163     ValIter vibrato_amp_it = <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a7">VIBRATO_AMP</a>).<a class="code" href="classDynamicVariable.html#a3">valueIterator</a>();
00164     ValIter vibrato_rate_it = <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a8">VIBRATO_RATE</a>).<a class="code" href="classDynamicVariable.html#a3">valueIterator</a>();
00165     ValIter phase_it = <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a9">PHASE</a>).<a class="code" href="classDynamicVariable.html#a3">valueIterator</a>();
00166     ValIter loudnes_scalar_it = <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a10">LOUDNESS_SCALAR</a>).<a class="code" href="classDynamicVariable.html#a3">valueIterator</a>();
00167     ValIter amptrans_width_it = <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a17">AMPTRANS_WIDTH</a>).<a class="code" href="classDynamicVariable.html#a3">valueIterator</a>();
00168     ValIter freqtrans_width_it = <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a18">FREQTRANS_WIDTH</a>).<a class="code" href="classDynamicVariable.html#a3">valueIterator</a>();
00169     <span class="comment">//ValIter freq_deviation_it = freq_dev-&gt;valueIterator();</span>
00170     <span class="comment">//ValIter gliss_it = gliss_env-&gt;valueIterator();</span>
00171     ValIter freq_it = freq_env-&gt;<a class="code" href="classDynamicVariable.html#a3">valueIterator</a>();
00172     <span class="comment">//ValIter detuning_it = detuning_env-&gt;valueIterator();</span>
00173     ValIter amptrans_amp_it = amptrans_amp_env-&gt;<a class="code" href="classDynamicVariable.html#a3">valueIterator</a>();
00174     ValIter amptrans_rate_it = amptrans_rate_env-&gt;<a class="code" href="classDynamicVariable.html#a3">valueIterator</a>();
00175     ValIter freqtrans_amp_it = freqtrans_amp_env-&gt;<a class="code" href="classDynamicVariable.html#a3">valueIterator</a>();
00176     ValIter freqtrans_rate_it = freqtrans_rate_env-&gt;<a class="code" href="classDynamicVariable.html#a3">valueIterator</a>();
00177 
00178     <span class="comment">// Phase values start off at zero for now:</span>
00179     <a class="code" href="Types_8h.html#a3">m_value_type</a> tremolo_phase = 0.0;
00180     <a class="code" href="Types_8h.html#a3">m_value_type</a> vibrato_phase = 0.0;
00181     <a class="code" href="Types_8h.html#a3">m_value_type</a> freq_phase = 0.0;
00182     
00183     <span class="comment">// values used in the loop:</span>
00184     <a class="code" href="Types_8h.html#a3">m_value_type</a> tremolo;
00185     <a class="code" href="Types_8h.html#a3">m_value_type</a> amplitude;
00186     <a class="code" href="Types_8h.html#a3">m_value_type</a> vibrato;
00187     <a class="code" href="Types_8h.html#a3">m_value_type</a> frequency;
00188     <a class="code" href="Types_8h.html#a3">m_value_type</a> phase;
00189     <a class="code" href="Types_8h.html#a3">m_value_type</a> sample;
00190     <a class="code" href="Types_8h.html#a3">m_value_type</a> amptransient;
00191     <a class="code" href="Types_8h.html#a3">m_value_type</a> freqtransient;
00192     <a class="code" href="Types_8h.html#a3">m_value_type</a> amptrans_width;
00193     <a class="code" href="Types_8h.html#a3">m_value_type</a> freqtrans_width;
00194     <a class="code" href="Types_8h.html#a2">m_time_type</a> amptransprob;
00195     <a class="code" href="Types_8h.html#a2">m_time_type</a> freqtransprob;
00196 
00197     srand(time(0));
00198 
00199     <span class="comment">//flags to tell if we are in a transient</span>
00200     <span class="keywordtype">int</span> amptransflag = 0;
00201     <span class="keywordtype">int</span> freqtransflag = 0;
00202     
00203     <span class="comment">//placemarkers once in a transient</span>
00204     <span class="keywordtype">int</span> amptransplace = 0;
00205     <span class="keywordtype">int</span> freqtransplace = 0;
00206     
00207     <span class="comment">//counters to see if we should check for a transient</span>
00208     <span class="keywordtype">int</span> amptranscheck = (<span class="keywordtype">int</span>)amptrans_width;
00209     <span class="keywordtype">int</span> freqtranscheck = (<span class="keywordtype">int</span>)freqtrans_width;
00210     <span class="keywordtype">float</span> random;
00211 
00212     <a class="code" href="Types_8h.html#a3">m_value_type</a> freqmod, trans_freqmod = 0;
00213     <a class="code" href="Types_8h.html#a3">m_value_type</a> amplifier,trans_amplifier = 0;
00214     <span class="comment">// loop over every sample:</span>
00215     <span class="keywordflow">for</span> (<a class="code" href="Types_8h.html#a1">m_sample_count_type</a> s=0; s &lt; numSamplesToRender; s++)
00216     {
00217       
00218       <span class="comment">// AMPLITUDE:</span>
00219     
00220       <span class="comment">//advance transient related iterators</span>
00221       amptrans_width = amptrans_width_it.next();
00222       trans_amplifier = amptrans_amp_it.next();
00223       amptransprob = amptrans_rate_it.next();
00224       
00225       <span class="comment">// grab the tremolo value</span>
00226         tremolo =  tremolo_amp_it.next() * sin(2.0 * M_PI * tremolo_phase);
00227         <span class="comment">// increment the tremolo phase</span>
00228         tremolo_phase = <a class="code" href="classPartial.html#d1">pmod</a>( tremolo_phase + (tremolo_rate_it.next() / samplingRate) );
00229         
00230         <span class="comment">//once counter reaches 0, check for transient</span>
00231         <span class="keywordflow">if</span>(amptranscheck &lt;= 0 &amp;&amp; s+amptrans_width &lt; numSamplesToRender)
00232           {
00233             random = ((<span class="keywordtype">float</span>)std::rand()/(<span class="keywordtype">float</span>)RAND_MAX);
00234             <span class="keywordflow">if</span>(random &lt;= amptransprob)
00235               {         
00236                 trans_amplifier *= (<span class="keywordtype">float</span>)std::rand()/(<span class="keywordtype">float</span>)RAND_MAX;
00237                 <span class="keywordflow">if</span>(((<span class="keywordtype">float</span>)std::rand()/(<span class="keywordtype">float</span>)RAND_MAX) &lt;= 0.5)
00238                   trans_amplifier *= -1;
00239                 amplifier = trans_amplifier;
00240                 amptransflag = 1;
00241                 <span class="comment">//we are at beginning of transient</span>
00242                 amptransplace = 0;
00243               }
00244             <span class="comment">//reset check counter</span>
00245             amptranscheck = (<span class="keywordtype">int</span>)amptrans_width;
00246           }
00247         
00248         <span class="comment">// augment the amplitude value by the tremolo value, and the loudness scale:</span>
00249         <span class="keywordflow">if</span>(amptransflag)         
00250           {
00251             <span class="comment">//the following decides where we are inside the transient</span>
00252             <span class="comment">//used to scale the transient multiplier effect</span>
00253             <span class="keywordflow">if</span>(amptransplace &lt; amptrans_width/2)
00254               amptransient = amplifier*amptransplace/(amptrans_width/2);
00255             <span class="keywordflow">else</span>
00256               amptransient = amplifier*(amptrans_width - amptransplace)/(amptrans_width/2);
00257             amptransplace++;
00258             <span class="keywordflow">if</span>(amptransplace &gt;= amptrans_width)
00259               amptransflag = 0;
00260           }
00261         <span class="keywordflow">else</span>
00262             amptransient = 0;
00263         
00264         <span class="comment">//decrease the check counter</span>
00265         amptranscheck--;
00266         
00267         amplitude = loudnes_scalar_it.next() * wave_shape_it.next() * (1.0 + tremolo);
00268         
00269         <span class="comment">//apply transient modifier to amplitude</span>
00270         amplitude = amplitude + amptransient*amplitude;
00271 
00272         
00273       
00274 
00275 
00276 
00277 
00278 
00279 
00280 
00281 
00282 
00283 
00284 
00285         <span class="comment">// FREQUENCY:</span>
00286         
00287         <span class="comment">//advance frequency transient related iterators</span>
00288         freqtrans_width = freqtrans_width_it.next();
00289         trans_freqmod = freqtrans_amp_it.next();
00290         freqtransprob = freqtrans_rate_it.next();
00291         
00292         <span class="comment">//if we should check, check</span>
00293         <span class="keywordflow">if</span>(freqtranscheck &lt;= 0 &amp;&amp; s+freqtrans_width &lt; numSamplesToRender)
00294           {
00295             random = ((<span class="keywordtype">float</span>)std::rand()/(<span class="keywordtype">float</span>)RAND_MAX);
00296             <span class="keywordflow">if</span>(random &lt;= freqtransprob)
00297               {         
00298                 trans_freqmod *= (<span class="keywordtype">float</span>)std::rand()/(<span class="keywordtype">float</span>)RAND_MAX;
00299                 <span class="keywordflow">if</span>(((<span class="keywordtype">float</span>)std::rand()/(<span class="keywordtype">float</span>)RAND_MAX) &lt;= 0.5)
00300                   trans_freqmod *= -1;
00301                 freqmod = trans_freqmod;
00302                 freqtransflag = 1;
00303                 freqtransplace = 0;
00304               }
00305             freqtranscheck = (<span class="keywordtype">int</span>)freqtrans_width;
00306           }
00307         
00308         <span class="comment">//if we are inside a transient, make appropriate changes</span>
00309         <span class="keywordflow">if</span>(freqtransflag)        
00310           {
00311             <span class="keywordflow">if</span>(freqtransplace &lt; freqtrans_width/2)
00312               freqtransient = freqmod*freqtransplace/(freqtrans_width/2);
00313             <span class="keywordflow">else</span>
00314               freqtransient = freqmod*(freqtrans_width - freqtransplace)/(freqtrans_width/2);
00315             freqtransplace++;
00316             <span class="keywordflow">if</span>(freqtransplace &gt;= freqtrans_width)
00317               freqtransflag = 0;
00318           }
00319         <span class="keywordflow">else</span>
00320             freqtransient = 0;
00321         freqtranscheck--;
00322 
00323         <span class="comment">// perhaps the vibrato should be keyed to PartialNumber.</span>
00324 
00325         <span class="comment">// grab the vibrato value</span>
00326         vibrato =  vibrato_amp_it.next() * sin(2.0 * M_PI * vibrato_phase);
00327         <span class="comment">// increment the vibrato phase</span>
00328         vibrato_phase = <a class="code" href="classPartial.html#d1">pmod</a>( vibrato_phase + (vibrato_rate_it.next() / samplingRate) );
00329 
00330         <span class="comment">// augment the frequency value by the freq-deviation and vibrato and detuning and freq_env and transients</span>
00331         frequency  = frequency_it.next() * freq_it.next(); <span class="comment">// * detuning_it.next()</span>
00332         <span class="comment">//frequency += freq_deviation_it.next();</span>
00333         frequency *= 1.0 + vibrato;
00334 
00335 
00336         <span class="comment">//apply frequency transient adjustments</span>
00337         frequency += frequency*freqtransient;
00338         
00339 
00340         <span class="comment">// increment the frequency phase:</span>
00341         freq_phase = <a class="code" href="classPartial.html#d1">pmod</a> (freq_phase + (frequency / samplingRate));
00342         
00343         <span class="comment">// calculate the actual phase, augmenting freq_phase with</span>
00344         <span class="comment">// they dynamic variable phase (phase offset)</span>
00345         phase = freq_phase + phase_it.next();
00346         
00347         
00348         <span class="comment">// SAMPLE:</span>
00349         
00350         <span class="keywordflow">switch</span>( (<span class="keywordtype">int</span>) <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a19a2">WAVE_TYPE</a>))
00351         {
00352             <span class="keywordflow">case</span> 1:
00353                 <span class="comment">// random</span>
00354                 sample = amplitude * 2 * ((((<span class="keywordtype">double</span>) std::rand()) / ((<span class="keywordtype">double</span>) RAND_MAX)) - 0.5);
00355                 <span class="keywordflow">break</span>;
00356 
00357             <span class="keywordflow">default</span>:
00358                 <span class="comment">// calculate the sample</span>
00359                 sample = amplitude * ( sin(2.0 * M_PI * phase));
00360                 <span class="keywordflow">break</span>;
00361         }
00362         
00363         <span class="comment">// assign it:</span>
00364         (*waveSample)[s] = sample;
00365         (*ampSample)[s] = amplitude;
00366     }
00367 
00368     <span class="comment">// create a TrackObject:</span>
00369     <a class="code" href="classTrack.html">Track</a> *returnTrack = <span class="keyword">new</span> <a class="code" href="classTrack.html">Track</a>(waveSample, ampSample);
00370 
00371     <span class="comment">// do the reverb, if necessary</span>
00372     <span class="keywordflow">if</span>(<a class="code" href="classPartial.html#r0">reverbObj</a> != NULL)
00373     {
00374         Track &amp;tmp = <a class="code" href="classPartial.html#r0">reverbObj</a>-&gt;<a class="code" href="classReverb.html#a9">do_reverb_Track</a>(*returnTrack);
00375         <span class="keyword">delete</span> returnTrack;
00376         returnTrack = <span class="keyword">new</span> Track(tmp);
00377 
00378         <span class="comment">// delete the temporary track object</span>
00379         <span class="keyword">delete</span> &amp;tmp;
00380 
00381     }
00382     <span class="keywordflow">return</span> returnTrack;
00383 }
00384 
00385 <span class="comment">//----------------------------------------------------------------------------//</span>
<a name="l00386"></a><a class="code" href="classPartial.html#d1">00386</a> <span class="keyword">inline</span> <a class="code" href="Types_8h.html#a3">m_value_type</a> <a class="code" href="classPartial.html#d1">Partial::pmod</a>(<a class="code" href="Types_8h.html#a3">m_value_type</a> num)
00387 {
00388     <span class="keywordflow">while</span> (num &gt; 1.0)
00389         num -= 1.0;
00390     <span class="keywordflow">return</span> num;
00391 }
00392 
00393 
00394 <span class="comment">//----------------------------------------------------------------------------//</span>
<a name="l00395"></a><a class="code" href="classPartial.html#a2">00395</a> <span class="keywordtype">void</span> <a class="code" href="classPartial.html#a2">Partial::use_reverb</a>(<a class="code" href="classReverb.html">Reverb</a> *newReverbObj)
00396 {
00397         <a class="code" href="classPartial.html#r0">reverbObj</a> = newReverbObj;
00398 }
00399 
00400 <span class="comment">//----------------------------------------------------------------------------//</span>
<a name="l00401"></a><a class="code" href="classPartial.html#a5">00401</a> <a class="code" href="Types_8h.html#a2">m_time_type</a> <a class="code" href="classPartial.html#a5">Partial::getTotalDuration</a>(<a class="code" href="Types_8h.html#a2">m_time_type</a> dryDuration)
00402 {
00403         <span class="keywordflow">return</span> dryDuration + ( (<a class="code" href="classPartial.html#r0">reverbObj</a> != 0) ? <a class="code" href="classPartial.html#r0">reverbObj</a>-&gt;<a class="code" href="classReverb.html#a11">getDecay</a>() : 0 );
00404 }
00405 
00406 <span class="comment">//----------------------------------------------------------------------------//</span>
<a name="l00407"></a><a class="code" href="classPartial.html#a3">00407</a> <span class="keywordtype">void</span> <a class="code" href="classPartial.html#a3">Partial::xml_print</a>( ofstream&amp; xmlOutput, list&lt;Reverb*&gt;&amp; revObjs, list&lt;DynamicVariable*&gt;&amp; dynObjs )
00408 {
00409 
00410         xmlOutput &lt;&lt; <span class="stringliteral">"\t\t&lt;partial&gt;"</span> &lt;&lt; endl;
00411 
00412         <span class="comment">// Output reverb ID and update reverb collection if necessary</span>
00413         xmlOutput &lt;&lt; <span class="stringliteral">"\t\t\t&lt;reverb_ptr id=\""</span> &lt;&lt; (<span class="keywordtype">long</span>)<a class="code" href="classPartial.html#r0">reverbObj</a> &lt;&lt; <span class="stringliteral">"\" /&gt;"</span> &lt;&lt; endl;
00414         list&lt;Reverb*&gt;::const_iterator revit;
00415         <span class="keywordflow">for</span>( revit=revObjs.begin(); revit != revObjs.end(); revit++ )
00416         {
00417                 <span class="keywordflow">if</span>( (*revit) == <a class="code" href="classPartial.html#r0">reverbObj</a> )
00418                         <span class="keywordflow">break</span>;
00419         }
00420         <span class="keywordflow">if</span>( revit == revObjs.end() ){
00421                 revObjs.push_back( <a class="code" href="classPartial.html#r0">reverbObj</a> );
00422         }
00423 
00424 
00425         <span class="comment">// Static Parameters</span>
00426         xmlOutput &lt;&lt; <span class="stringliteral">"\t\t\t&lt;relative_amplitude value=\""</span> &lt;&lt; <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a19a0">RELATIVE_AMPLITUDE</a>) &lt;&lt; <span class="stringliteral">"\" /&gt;"</span> &lt;&lt; endl;
00427         xmlOutput &lt;&lt; <span class="stringliteral">"\t\t\t&lt;partial_num value=\""</span> &lt;&lt; <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a19a1">PARTIAL_NUM</a>) &lt;&lt; <span class="stringliteral">"\" /&gt;"</span> &lt;&lt; endl;
00428 
00429         <span class="comment">// Dynamic Paramters</span>
00430         <span class="comment">// Call the xml_print for each Dynamic Var</span>
00431 
00432         xmlOutput &lt;&lt; <span class="stringliteral">"\t\t\t&lt;frequency&gt;"</span> &lt;&lt; endl;
00433         <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a3">FREQUENCY</a>).<a class="code" href="classDynamicVariable.html#a11">xml_print</a>( xmlOutput, dynObjs );
00434         xmlOutput &lt;&lt; <span class="stringliteral">"\t\t\t&lt;/frequency&gt;"</span> &lt;&lt; endl;
00435        
00436         xmlOutput &lt;&lt; <span class="stringliteral">"\t\t\t&lt;wave_shape&gt;"</span> &lt;&lt; endl;
00437         <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a4">WAVE_SHAPE</a>).<a class="code" href="classDynamicVariable.html#a11">xml_print</a>( xmlOutput, dynObjs );
00438         xmlOutput &lt;&lt; <span class="stringliteral">"\t\t\t&lt;/wave_shape&gt;"</span> &lt;&lt; endl;
00439         
00440         xmlOutput &lt;&lt; <span class="stringliteral">"\t\t\t&lt;loudness_scalar&gt;"</span> &lt;&lt; endl;
00441         <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a10">LOUDNESS_SCALAR</a>).<a class="code" href="classDynamicVariable.html#a11">xml_print</a>( xmlOutput, dynObjs );
00442         xmlOutput &lt;&lt; <span class="stringliteral">"\t\t\t&lt;/loudness_scalar&gt;"</span> &lt;&lt; endl;
00443 
00444         xmlOutput &lt;&lt; <span class="stringliteral">"\t\t\t&lt;tremolo_amp&gt;"</span> &lt;&lt; endl;
00445         <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a5">TREMOLO_AMP</a>).<a class="code" href="classDynamicVariable.html#a11">xml_print</a>( xmlOutput, dynObjs );
00446         xmlOutput &lt;&lt; <span class="stringliteral">"\t\t\t&lt;/tremolo_amp&gt;"</span> &lt;&lt; endl;
00447         
00448         xmlOutput &lt;&lt; <span class="stringliteral">"\t\t\t&lt;tremolo_rate&gt;"</span> &lt;&lt; endl;
00449         <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a6">TREMOLO_RATE</a>).<a class="code" href="classDynamicVariable.html#a11">xml_print</a>( xmlOutput, dynObjs );
00450         xmlOutput &lt;&lt; <span class="stringliteral">"\t\t\t&lt;/tremolo_rate&gt;"</span> &lt;&lt; endl;
00451         
00452         xmlOutput &lt;&lt; <span class="stringliteral">"\t\t\t&lt;vibrato_amp&gt;"</span> &lt;&lt; endl;
00453         <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a7">VIBRATO_AMP</a>).<a class="code" href="classDynamicVariable.html#a11">xml_print</a>( xmlOutput, dynObjs );
00454         xmlOutput &lt;&lt; <span class="stringliteral">"\t\t\t&lt;/vibrato_amp&gt;"</span> &lt;&lt; endl;
00455         
00456         xmlOutput &lt;&lt; <span class="stringliteral">"\t\t\t&lt;vibrato_rate&gt;"</span> &lt;&lt; endl;
00457         <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a8">VIBRATO_RATE</a>).<a class="code" href="classDynamicVariable.html#a11">xml_print</a>( xmlOutput, dynObjs );
00458         xmlOutput &lt;&lt; <span class="stringliteral">"\t\t\t&lt;/vibrato_rate&gt;"</span> &lt;&lt; endl;
00459         
00460         xmlOutput &lt;&lt; <span class="stringliteral">"\t\t\t&lt;phase&gt;"</span> &lt;&lt; endl;
00461         <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a9">PHASE</a>).<a class="code" href="classDynamicVariable.html#a11">xml_print</a>( xmlOutput, dynObjs );
00462         xmlOutput &lt;&lt; <span class="stringliteral">"\t\t\t&lt;/phase&gt;"</span> &lt;&lt; endl;
00463 
00464         <span class="comment">//xmlOutput &lt;&lt; "\t\t\t&lt;frequency_deviation&gt;" &lt;&lt; endl;</span>
00465         <span class="comment">//getParam(FREQUENCY_DEVIATION).xml_print( xmlOutput, dynObjs );</span>
00466         <span class="comment">//xmlOutput &lt;&lt; "\t\t\t&lt;/frequency_deviation&gt;" &lt;&lt; endl;</span>
00467         
00468         <span class="comment">/*xmlOutput &lt;&lt; "\t\t\t&lt;glissando_env&gt;" &lt;&lt; endl;</span>
00469 <span class="comment">        getParam(GLISSANDO_ENV).xml_print( xmlOutput, dynObjs );</span>
00470 <span class="comment">        xmlOutput &lt;&lt; "\t\t\t&lt;/glissando_env&gt;" &lt;&lt; endl;</span>
00471 <span class="comment">        */</span>
00472         
00473 
00474         xmlOutput &lt;&lt; <span class="stringliteral">"\t\t\t&lt;freq_env&gt;"</span> &lt;&lt; endl;
00475         <a class="code" href="classParameterLib.html#a6">getParam</a>(<a class="code" href="Partial_8h.html#a20a11">FREQ_ENV</a>).<a class="code" href="classDynamicVariable.html#a11">xml_print</a>(xmlOutput, dynObjs);
00476         xmlOutput &lt;&lt; <span class="stringliteral">"\t\t\t&lt;/freq_env&gt;"</span> &lt;&lt; endl;
00477 
00478 
00479         <span class="comment">//xmlOutput &lt;&lt; "\t\t\t&lt;detuning_env&gt;" &lt;&lt; endl;</span>
00480         <span class="comment">//getParam(DETUNING_ENV).xml_print( xmlOutput, dynObjs );</span>
00481         <span class="comment">//xmlOutput &lt;&lt; "\t\t\t&lt;/detuning_env&gt;" &lt;&lt; endl;</span>
00482 
00483         xmlOutput &lt;&lt; <span class="stringliteral">"\t\t&lt;/partial&gt;"</span> &lt;&lt; endl;
00484 }
00485 
<a name="l00486"></a><a class="code" href="classPartial.html#a4">00486</a> <span class="keywordtype">void</span> <a class="code" href="classPartial.html#a4">Partial::xml_read</a>(<a class="code" href="classXmlReader_1_1xmltag.html">XmlReader::xmltag</a>* partialtag, hash_map&lt;long, Reverb *&gt;* reverbHash, hash_map&lt;long, DynamicVariable *&gt; *dvHash)
00487 {
00488         <span class="keywordflow">if</span>(strcmp(<span class="stringliteral">"partial"</span>,partialtag-&gt;<a class="code" href="classXmlReader_1_1xmltag.html#o0">name</a>))
00489         {
00490                 printf(<span class="stringliteral">"Not a partial tag!  This is a %s tag.\n"</span>,partialtag-&gt;<a class="code" href="classXmlReader_1_1xmltag.html#o0">name</a>);
00491                 <span class="keywordflow">return</span>;
00492         }
00493 
00494         <span class="keywordtype">char</span> *value;
00495 
00496         <span class="keywordflow">if</span>(value=partialtag-&gt;<a class="code" href="classXmlReader_1_1xmltag.html#a5">findChildParamValue</a>(<span class="stringliteral">"reverb_ptr"</span>,<span class="stringliteral">"id"</span>))
00497         {
00498                 <span class="keywordtype">long</span> id=atoi(value);
00499                 <a class="code" href="classReverb.html">Reverb</a> * temp;
00500                 temp = (*reverbHash)[id];
00501                 
00502                 <span class="keywordflow">if</span>(temp != NULL)
00503                 {
00504                         <a class="code" href="classPartial.html#a2">use_reverb</a>(temp);
00505                 }
00506         }
00507 
00508         <span class="keywordflow">if</span>(value=partialtag-&gt;<a class="code" href="classXmlReader_1_1xmltag.html#a5">findChildParamValue</a>(<span class="stringliteral">"relative_amplitude"</span>,<span class="stringliteral">"value"</span>))
00509         {
00510                 <a class="code" href="classParameterLib.html#a4">setParam</a>(<a class="code" href="Partial_8h.html#a19a0">RELATIVE_AMPLITUDE</a>, atof(value));
00511         }
00512 
00513         <span class="keywordflow">if</span>(value=partialtag-&gt;<a class="code" href="classXmlReader_1_1xmltag.html#a5">findChildParamValue</a>(<span class="stringliteral">"partial_num"</span>,<span class="stringliteral">"value"</span>))
00514         {
00515                 <a class="code" href="classParameterLib.html#a4">setParam</a>(<a class="code" href="Partial_8h.html#a19a1">PARTIAL_NUM</a>, atoi(value));
00516         }
00517 
00518         <span class="comment">// For sake of ease, I am going to forego searching for each item and instead</span>
00519         <span class="comment">// iterate thru the list of child tags.</span>
00520 
00521         <a class="code" href="classXmlReader_1_1xmltag.html">XmlReader::xmltag</a> *dvtag;       <a class="code" href="classXmlReader_1_1xmltagset.html">XmlReader::xmltagset</a> *child=partialtag-&gt;<a class="code" href="classXmlReader_1_1xmltag.html#o3">children</a>;
00522 
00523         <span class="keywordflow">while</span>(child)
00524         {
00525                 dvtag=child-&gt;<a class="code" href="classXmlReader_1_1xmltagset.html#o0">tag</a>;
00526 
00527                 <span class="keywordflow">if</span>(strcmp(dvtag-&gt;<a class="code" href="classXmlReader_1_1xmltag.html#o0">name</a>,<span class="stringliteral">"frequency"</span>) == 0)
00528                         <a class="code" href="classPartial.html#d0">auxLoadParam</a>(<a class="code" href="Partial_8h.html#a20a3">FREQUENCY</a>,dvtag,dvHash);
00529                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strcmp(dvtag-&gt;<a class="code" href="classXmlReader_1_1xmltag.html#o0">name</a>,<span class="stringliteral">"wave_shape"</span>) == 0)
00530                         <a class="code" href="classPartial.html#d0">auxLoadParam</a>(<a class="code" href="Partial_8h.html#a20a4">WAVE_SHAPE</a>,dvtag,dvHash);
00531                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strcmp(dvtag-&gt;<a class="code" href="classXmlReader_1_1xmltag.html#o0">name</a>,<span class="stringliteral">"loudness_scalar"</span>) == 0)
00532                         <a class="code" href="classPartial.html#d0">auxLoadParam</a>(<a class="code" href="Partial_8h.html#a20a10">LOUDNESS_SCALAR</a>,dvtag,dvHash);
00533                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strcmp(dvtag-&gt;<a class="code" href="classXmlReader_1_1xmltag.html#o0">name</a>,<span class="stringliteral">"tremolo_amp"</span>) == 0)
00534                         <a class="code" href="classPartial.html#d0">auxLoadParam</a>(<a class="code" href="Partial_8h.html#a20a5">TREMOLO_AMP</a>,dvtag,dvHash);
00535                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strcmp(dvtag-&gt;<a class="code" href="classXmlReader_1_1xmltag.html#o0">name</a>,<span class="stringliteral">"tremolo_rate"</span>) == 0)
00536                         <a class="code" href="classPartial.html#d0">auxLoadParam</a>(<a class="code" href="Partial_8h.html#a20a6">TREMOLO_RATE</a>,dvtag,dvHash);
00537                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strcmp(dvtag-&gt;<a class="code" href="classXmlReader_1_1xmltag.html#o0">name</a>,<span class="stringliteral">"vibrato_amp"</span>) == 0)
00538                         <a class="code" href="classPartial.html#d0">auxLoadParam</a>(<a class="code" href="Partial_8h.html#a20a7">VIBRATO_AMP</a>,dvtag,dvHash);
00539                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strcmp(dvtag-&gt;<a class="code" href="classXmlReader_1_1xmltag.html#o0">name</a>,<span class="stringliteral">"vibrato_rate"</span>) == 0)
00540                         <a class="code" href="classPartial.html#d0">auxLoadParam</a>(<a class="code" href="Partial_8h.html#a20a8">VIBRATO_RATE</a>,dvtag,dvHash);
00541                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strcmp(dvtag-&gt;<a class="code" href="classXmlReader_1_1xmltag.html#o0">name</a>,<span class="stringliteral">"phase"</span>) == 0)
00542                         <a class="code" href="classPartial.html#d0">auxLoadParam</a>(<a class="code" href="Partial_8h.html#a20a9">PHASE</a>,dvtag,dvHash);
00543                 <span class="comment">//else if(strcmp(dvtag-&gt;name,"frequency_deviation") == 0)</span>
00544                 <span class="comment">//auxLoadParam(FREQUENCY_DEVIATION,dvtag,dvHash);</span>
00545                 <span class="comment">//else if(strcmp(dvtag-&gt;name,"glissando_env") == 0)</span>
00546                 <span class="comment">//auxLoadParam(GLISSANDO_ENV,dvtag,dvHash);</span>
00547                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strcmp(dvtag-&gt;<a class="code" href="classXmlReader_1_1xmltag.html#o0">name</a>,<span class="stringliteral">"freq_env"</span>) == 0)
00548                   <a class="code" href="classPartial.html#d0">auxLoadParam</a>(<a class="code" href="Partial_8h.html#a20a11">FREQ_ENV</a>,dvtag,dvHash);
00549                 <span class="comment">//else if(strcmp(dvtag-&gt;name,"detuning_env") == 0)</span>
00550                 <span class="comment">//auxLoadParam(DETUNING_ENV,dvtag,dvHash);</span>
00551 
00552                 child=child-&gt;<a class="code" href="classXmlReader_1_1xmltagset.html#o1">next</a>;
00553         }
00554 }
00555 
<a name="l00556"></a><a class="code" href="classPartial.html#d0">00556</a> <span class="keywordtype">void</span> <a class="code" href="classPartial.html#d0">Partial::auxLoadParam</a>(<span class="keyword">enum</span> PartialDynamicParam param,<a class="code" href="classXmlReader_1_1xmltag.html">XmlReader::xmltag</a> *tag, hash_map&lt;long, DynamicVariable *&gt; *dvHash)
00557 {
00558         <span class="keywordtype">char</span> *value;
00559 
00560         <span class="comment">// Try and do a lookup</span>
00561         <span class="keywordflow">if</span>(value=tag-&gt;<a class="code" href="classXmlReader_1_1xmltag.html#a5">findChildParamValue</a>(<span class="stringliteral">"dv_ptr"</span>,<span class="stringliteral">"id"</span>))
00562         {
00563                 <span class="keywordtype">long</span> id=atol(value);
00564                 <a class="code" href="classDynamicVariable.html">DynamicVariable</a> *dv=(*dvHash)[id];
00565 
00566                 <span class="keywordflow">if</span>(dv)
00567                         <a class="code" href="classParameterLib.html#a4">setParam</a>(param,*dv);
00568                 <span class="keywordflow">else</span>
00569                         printf(<span class="stringliteral">"[%s:%d] PartialParam refrences non-existant dv %d!\n"</span>,__FILE__,__LINE__,id);
00570         }
00571 
00572         <span class="comment">//Else read in the tag</span>
00573         <span class="keywordflow">else</span>
00574         {
00575                 <a class="code" href="classDynamicVariable.html">DynamicVariable</a> *dv=<a class="code" href="classDynamicVariable.html#e0">DynamicVariable::create_dv_from_xml</a>(tag);
00576                 <a class="code" href="classParameterLib.html#a4">setParam</a>(param,*dv);
00577         }
00578 }
00579 
00580 <span class="preprocessor">#endif //__PARTIAL_CPP</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Mon Apr 25 13:18:12 2005 for LASS by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
